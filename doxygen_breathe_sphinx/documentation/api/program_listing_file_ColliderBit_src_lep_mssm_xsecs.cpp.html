<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Program Listing for File lep_mssm_xsecs.cpp &mdash; GAMBIT  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/collapsible-lists/css/tree_view.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  <div class="col-lg-9 col-xl-8 text-center">
    <p class="meta"><a href="/">⇦ Back to GAMBIT homepage</a></p>
  </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div> 

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../exhale_documentation/library_root.html">Library API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GAMBIT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Program Listing for File lep_mssm_xsecs.cpp</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="program-listing-for-file-lep-mssm-xsecs-cpp">
<span id="program-listing-file-colliderbit-src-lep-mssm-xsecs-cpp"></span><h1>Program Listing for File lep_mssm_xsecs.cpp<a class="headerlink" href="#program-listing-for-file-lep-mssm-xsecs-cpp" title="Permalink to this headline"></a></h1>
<p>↰ <a class="reference internal" href="../exhale_documentation/file_ColliderBit_src_lep_mssm_xsecs.cpp.html#file-colliderbit-src-lep-mssm-xsecs-cpp"><span class="std std-ref">Return to documentation for file</span></a> (<code class="docutils literal notranslate"><span class="pre">ColliderBit/src/lep_mssm_xsecs.cpp</span></code>)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//   GAMBIT: Global and Modular BSM Inference Tool</span>
<span class="c1">//   *********************************************</span>


<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;math.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gambit/Elements/gambit_module_headers.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gambit/Elements/mssm_slhahelp.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gambit/ColliderBit/ColliderBit_rollcall.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gambit/ColliderBit/lep_mssm_xsecs.hpp&quot;</span><span class="cp"></span>


<span class="cp">#define pow2(a) ((a)*(a)) </span><span class="c1">// Get speedy</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">Gambit</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="k">namespace</span><span class="w"> </span><span class="nn">ColliderBit</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">get_sigma_ee_ll</span><span class="p">(</span><span class="n">triplet</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">generation</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">l_chirality</span><span class="p">,</span><span class="w"></span>
<span class="w">                         </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">lbar_chirality</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">gtol</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">ftol</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">gpt_error</span><span class="p">,</span><span class="w"></span>
<span class="w">                         </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">fpt_error</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Spectrum</span><span class="o">&amp;</span><span class="w"> </span><span class="n">spec</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">gammaZ</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">l_are_gauge_es</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="n">genmap</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="s">&quot;~e_L&quot;</span><span class="p">,</span><span class="w">   </span><span class="s">&quot;~e_R&quot;</span><span class="w">  </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="s">&quot;~mu_L&quot;</span><span class="p">,</span><span class="w">  </span><span class="s">&quot;~mu_R&quot;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="s">&quot;~tau_L&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~tau_R&quot;</span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">};</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Subspectrum</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">SubSpectrum</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mssm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">get_HE</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="c1">// PDG codes</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000000</span><span class="o">*</span><span class="n">l_chirality</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">generation</span><span class="mi">-1</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="mi">1000000</span><span class="o">*</span><span class="n">lbar_chirality</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">generation</span><span class="mi">-1</span><span class="p">));</span><span class="w"></span>

<span class="w">      </span><span class="c1">// SM parameters</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">g2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">dimensionless</span><span class="p">,</span><span class="s">&quot;g2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">sinW2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">dimensionless</span><span class="p">,</span><span class="s">&quot;sinW2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.25</span><span class="o">*</span><span class="n">sinW2</span><span class="o">*</span><span class="n">g2</span><span class="o">*</span><span class="n">g2</span><span class="o">/</span><span class="n">pi</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">// MSSM parameters</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">tanb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">dimensionless</span><span class="p">,</span><span class="s">&quot;tanbeta&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Get the mass eigenstate strings and 2x2 slepton generation mass mixing matrix</span>
<span class="w">      </span><span class="n">str</span><span class="w"> </span><span class="n">mass_es1</span><span class="p">,</span><span class="w"> </span><span class="n">mass_es2</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">MixMatrix</span><span class="w"> </span><span class="n">sleptonmix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span><span class="w"></span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">l_are_gauge_es</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Requested final states are gauge eigenstates.  Pass diagonal mixing matrix to low-level routine.</span>
<span class="w">        </span><span class="n">sleptonmix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">sleptonmix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">sleptonmix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">sleptonmix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">mass_es1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slhahelp</span><span class="o">::</span><span class="n">mass_es_from_gauge_es</span><span class="p">(</span><span class="n">genmap</span><span class="p">[</span><span class="n">generation</span><span class="mi">-1</span><span class="p">][</span><span class="n">l_chirality</span><span class="mi">-1</span><span class="p">],</span><span class="w">    </span><span class="n">mssm</span><span class="p">,</span><span class="w"> </span><span class="n">gtol</span><span class="p">,</span><span class="w"> </span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="n">gpt_error</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">mass_es2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slhahelp</span><span class="o">::</span><span class="n">mass_es_from_gauge_es</span><span class="p">(</span><span class="n">genmap</span><span class="p">[</span><span class="n">generation</span><span class="mi">-1</span><span class="p">][</span><span class="n">lbar_chirality</span><span class="mi">-1</span><span class="p">],</span><span class="w"> </span><span class="n">mssm</span><span class="p">,</span><span class="w"> </span><span class="n">gtol</span><span class="p">,</span><span class="w"> </span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="n">gpt_error</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Requested final states are family mass eigenstates.  Pass 2x2 family mass mixing matrix to low-level routine.</span>
<span class="w">        </span><span class="n">str</span><span class="w"> </span><span class="n">m_light</span><span class="p">,</span><span class="w"> </span><span class="n">m_heavy</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">slepton4vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slhahelp</span><span class="o">::</span><span class="n">family_state_mix_matrix</span><span class="p">(</span><span class="s">&quot;~e-&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">generation</span><span class="p">,</span><span class="w"> </span><span class="n">m_light</span><span class="p">,</span><span class="w"> </span><span class="n">m_heavy</span><span class="p">,</span><span class="w"> </span><span class="n">mssm</span><span class="p">,</span><span class="w"> </span><span class="n">ftol</span><span class="p">,</span><span class="w"> </span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="n">fpt_error</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">mass_es1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">l_chirality</span><span class="w">    </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">m_light</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_heavy</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">mass_es2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lbar_chirality</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">m_light</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_heavy</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">sleptonmix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slepton4vec</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="n">sleptonmix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slepton4vec</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="n">sleptonmix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slepton4vec</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="n">sleptonmix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slepton4vec</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass</span><span class="p">,</span><span class="n">mass_es1</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="c1">// FIXME when spectrum object has separate pole mass getters for antiparticles</span>
<span class="w">      </span><span class="c1">//const double m2 = spec.safeget(Par::Pole_Mass,Models::ParticleDB().get_antiparticle(mass_es2));</span>
<span class="w">      </span><span class="c1">// until then</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass</span><span class="p">,</span><span class="n">mass_es2</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m1_uncerts</span><span class="p">(</span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass_1srd_high</span><span class="p">,</span><span class="w"> </span><span class="n">mass_es1</span><span class="p">),</span><span class="w"></span>
<span class="w">                                          </span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass_1srd_low</span><span class="p">,</span><span class="w">  </span><span class="n">mass_es1</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m2_uncerts</span><span class="p">(</span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass_1srd_high</span><span class="p">,</span><span class="w"> </span><span class="n">mass_es2</span><span class="p">),</span><span class="w"></span>
<span class="w">                                          </span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass_1srd_low</span><span class="p">,</span><span class="w">  </span><span class="n">mass_es2</span><span class="p">));</span><span class="w"></span>

<span class="w">      </span><span class="c1">// If the final state is kinematically inaccessible *even* if both masses</span>
<span class="w">      </span><span class="c1">// are 2simga lower than their central values, then return zero.</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0-2.0</span><span class="o">*</span><span class="n">m1_uncerts</span><span class="p">.</span><span class="n">second</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0-2.0</span><span class="o">*</span><span class="n">m2_uncerts</span><span class="p">.</span><span class="n">second</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">sqrts</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">central</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Get the neutralino masses</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">neutmass</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass</span><span class="p">,</span><span class="mi">1000022</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass</span><span class="p">,</span><span class="mi">1000023</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">                                   </span><span class="n">spec</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass</span><span class="p">,</span><span class="mi">1000025</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass</span><span class="p">,</span><span class="mi">1000035</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Get the 4x4 neutralino mixing matrix</span>
<span class="w">      </span><span class="n">MixMatrix</span><span class="w"> </span><span class="n">neutmix</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">4</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">neutmix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mixing</span><span class="p">,</span><span class="s">&quot;~chi0&quot;</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Convert neutralino mixing matrix to BFM convention</span>
<span class="w">      </span><span class="n">SLHA2BFM_NN</span><span class="p">(</span><span class="n">neutmix</span><span class="p">,</span><span class="w"> </span><span class="n">tanb</span><span class="p">,</span><span class="w"> </span><span class="n">sinW2</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Calculate the cross-section</span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="n">central</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsec_sleislej</span><span class="p">(</span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="p">,</span><span class="w"> </span><span class="n">m2</span><span class="p">,</span><span class="w"> </span><span class="n">sleptonmix</span><span class="p">,</span><span class="w"> </span><span class="n">neutmix</span><span class="p">,</span><span class="w"> </span><span class="n">neutmass</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">mZ</span><span class="p">,</span><span class="w"> </span><span class="n">gammaZ</span><span class="p">,</span><span class="w"> </span><span class="n">sinW2</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Calculate the uncertainty on the cross-section due to final state masses varying by +/- 1 sigma</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">xsecs</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">xsecs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">central</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">xsecs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">xsec_sleislej</span><span class="p">(</span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">m1_uncerts</span><span class="p">.</span><span class="n">first</span><span class="p">),</span><span class="w"> </span><span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">m2_uncerts</span><span class="p">.</span><span class="n">first</span><span class="p">),</span><span class="w"> </span><span class="n">sleptonmix</span><span class="p">,</span><span class="w"> </span><span class="n">neutmix</span><span class="p">,</span><span class="w"></span>
<span class="w">                                   </span><span class="n">neutmass</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">mZ</span><span class="p">,</span><span class="w"> </span><span class="n">gammaZ</span><span class="p">,</span><span class="w"> </span><span class="n">sinW2</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">xsecs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">xsec_sleislej</span><span class="p">(</span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">m1_uncerts</span><span class="p">.</span><span class="n">second</span><span class="p">),</span><span class="w"> </span><span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">m2_uncerts</span><span class="p">.</span><span class="n">first</span><span class="p">),</span><span class="w"> </span><span class="n">sleptonmix</span><span class="p">,</span><span class="w"> </span><span class="n">neutmix</span><span class="p">,</span><span class="w"></span>
<span class="w">                                   </span><span class="n">neutmass</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">mZ</span><span class="p">,</span><span class="w"> </span><span class="n">gammaZ</span><span class="p">,</span><span class="w"> </span><span class="n">sinW2</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">xsecs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">xsec_sleislej</span><span class="p">(</span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">m1_uncerts</span><span class="p">.</span><span class="n">first</span><span class="p">),</span><span class="w"> </span><span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">m2_uncerts</span><span class="p">.</span><span class="n">second</span><span class="p">),</span><span class="w"> </span><span class="n">sleptonmix</span><span class="p">,</span><span class="w"> </span><span class="n">neutmix</span><span class="p">,</span><span class="w"></span>
<span class="w">                                   </span><span class="n">neutmass</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">mZ</span><span class="p">,</span><span class="w"> </span><span class="n">gammaZ</span><span class="p">,</span><span class="w"> </span><span class="n">sinW2</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">xsecs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">xsec_sleislej</span><span class="p">(</span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">m1_uncerts</span><span class="p">.</span><span class="n">second</span><span class="p">),</span><span class="w"> </span><span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">m2_uncerts</span><span class="p">.</span><span class="n">second</span><span class="p">),</span><span class="w"> </span><span class="n">sleptonmix</span><span class="p">,</span><span class="w"> </span><span class="n">neutmix</span><span class="p">,</span><span class="w"></span>
<span class="w">                                   </span><span class="n">neutmass</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">mZ</span><span class="p">,</span><span class="w"> </span><span class="n">gammaZ</span><span class="p">,</span><span class="w"> </span><span class="n">sinW2</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="n">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">std</span><span class="o">::</span><span class="n">max_element</span><span class="p">(</span><span class="n">xsecs</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">xsecs</span><span class="p">.</span><span class="n">end</span><span class="p">());</span><span class="w"></span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="n">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">std</span><span class="o">::</span><span class="n">min_element</span><span class="p">(</span><span class="n">xsecs</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">xsecs</span><span class="p">.</span><span class="n">end</span><span class="p">());</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>


<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">get_sigma_ee_chi00</span><span class="p">(</span><span class="n">triplet</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">chi_first</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">chi_second</span><span class="p">,</span><span class="w"></span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">tol</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">pt_error</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Spectrum</span><span class="o">&amp;</span><span class="w"> </span><span class="n">spec</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">gammaZ</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Subspectrum</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">SubSpectrum</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mssm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">get_HE</span><span class="p">();</span><span class="w"></span>

<span class="w">      </span><span class="c1">// PDG codes</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000021</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">chi_first</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">chi_first</span><span class="w">  </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">chi_first</span><span class="w"> </span><span class="mi">-3</span><span class="p">)</span><span class="o">*</span><span class="mi">9</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000021</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">chi_second</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">chi_second</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">chi_second</span><span class="mi">-3</span><span class="p">)</span><span class="o">*</span><span class="mi">9</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// SM parameters</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">g2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">dimensionless</span><span class="p">,</span><span class="s">&quot;g2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">sinW2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">dimensionless</span><span class="p">,</span><span class="s">&quot;sinW2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.25</span><span class="o">*</span><span class="n">sinW2</span><span class="o">*</span><span class="n">g2</span><span class="o">*</span><span class="n">g2</span><span class="o">/</span><span class="n">pi</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// MSSM parameters</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">tanb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">dimensionless</span><span class="p">,</span><span class="s">&quot;tanbeta&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Get the mass eigenstates best corresponding to ~eL and ~eR.</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="n">mass_esL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slhahelp</span><span class="o">::</span><span class="n">mass_es_from_gauge_es</span><span class="p">(</span><span class="s">&quot;~e_L&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mssm</span><span class="p">,</span><span class="w"> </span><span class="n">tol</span><span class="p">,</span><span class="w"> </span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="n">pt_error</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="n">mass_esR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slhahelp</span><span class="o">::</span><span class="n">mass_es_from_gauge_es</span><span class="p">(</span><span class="s">&quot;~e_R&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mssm</span><span class="p">,</span><span class="w"> </span><span class="n">tol</span><span class="p">,</span><span class="w"> </span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="n">pt_error</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Get the slepton masses</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">spec</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass</span><span class="p">,</span><span class="n">mass_esL</span><span class="p">),</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass</span><span class="p">,</span><span class="n">mass_esR</span><span class="p">)};</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Get the neutralino masses</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass</span><span class="p">,</span><span class="n">id1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass</span><span class="p">,</span><span class="n">id2</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m1_uncerts</span><span class="p">(</span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass_1srd_high</span><span class="p">,</span><span class="w"> </span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">                                          </span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass_1srd_low</span><span class="p">,</span><span class="w">  </span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m2_uncerts</span><span class="p">(</span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass_1srd_high</span><span class="p">,</span><span class="w"> </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">                                          </span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass_1srd_low</span><span class="p">,</span><span class="w">  </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Just return zero if the final state is kinematically inaccessible</span>
<span class="w">      </span><span class="c1">// *even* if both masses are 2simga lower than their central values</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0-2.0</span><span class="o">*</span><span class="n">m1_uncerts</span><span class="p">.</span><span class="n">second</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0-2.0</span><span class="o">*</span><span class="n">m2_uncerts</span><span class="p">.</span><span class="n">second</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">sqrts</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">central</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Get the 4x4 neutralino mixing matrix</span>
<span class="w">      </span><span class="n">MixMatrix</span><span class="w"> </span><span class="n">neutmix</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">4</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">neutmix</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mixing</span><span class="p">,</span><span class="s">&quot;~chi0&quot;</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Convert neutralino mixing matrix to BFM convention</span>
<span class="w">      </span><span class="n">SLHA2BFM_NN</span><span class="p">(</span><span class="n">neutmix</span><span class="p">,</span><span class="w"> </span><span class="n">tanb</span><span class="p">,</span><span class="w"> </span><span class="n">sinW2</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Calculate the cross-section</span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="n">central</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsec_neuineuj</span><span class="p">(</span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="p">,</span><span class="w"> </span><span class="n">m2</span><span class="p">,</span><span class="w"> </span><span class="n">neutmix</span><span class="p">,</span><span class="w"> </span><span class="n">mS</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="o">/</span><span class="n">tanb</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">mZ</span><span class="p">,</span><span class="w"> </span><span class="n">gammaZ</span><span class="p">,</span><span class="w"> </span><span class="n">sinW2</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Calculate the uncertainty on the cross-section due to final state masses varying by +/- 1 sigma</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">xsecs</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">xsecs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">central</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">xsecs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">xsec_neuineuj</span><span class="p">(</span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">m1_uncerts</span><span class="p">.</span><span class="n">first</span><span class="p">),</span><span class="w"> </span><span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">m2_uncerts</span><span class="p">.</span><span class="n">first</span><span class="p">),</span><span class="w"></span>
<span class="w">                                    </span><span class="n">neutmix</span><span class="p">,</span><span class="w"> </span><span class="n">mS</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="o">/</span><span class="n">tanb</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">mZ</span><span class="p">,</span><span class="w"> </span><span class="n">gammaZ</span><span class="p">,</span><span class="w"> </span><span class="n">sinW2</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">xsecs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">xsec_neuineuj</span><span class="p">(</span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">m1_uncerts</span><span class="p">.</span><span class="n">first</span><span class="p">),</span><span class="w"> </span><span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">m2_uncerts</span><span class="p">.</span><span class="n">second</span><span class="p">),</span><span class="w"></span>
<span class="w">                                    </span><span class="n">neutmix</span><span class="p">,</span><span class="w"> </span><span class="n">mS</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="o">/</span><span class="n">tanb</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">mZ</span><span class="p">,</span><span class="w"> </span><span class="n">gammaZ</span><span class="p">,</span><span class="w"> </span><span class="n">sinW2</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">xsecs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">xsec_neuineuj</span><span class="p">(</span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">m1_uncerts</span><span class="p">.</span><span class="n">second</span><span class="p">),</span><span class="w"> </span><span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">m2_uncerts</span><span class="p">.</span><span class="n">first</span><span class="p">),</span><span class="w"></span>
<span class="w">                                    </span><span class="n">neutmix</span><span class="p">,</span><span class="w"> </span><span class="n">mS</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="o">/</span><span class="n">tanb</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">mZ</span><span class="p">,</span><span class="w"> </span><span class="n">gammaZ</span><span class="p">,</span><span class="w"> </span><span class="n">sinW2</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">xsecs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">xsec_neuineuj</span><span class="p">(</span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">m1_uncerts</span><span class="p">.</span><span class="n">second</span><span class="p">),</span><span class="w"> </span><span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">m2_uncerts</span><span class="p">.</span><span class="n">second</span><span class="p">),</span><span class="w"></span>
<span class="w">                                    </span><span class="n">neutmix</span><span class="p">,</span><span class="w"> </span><span class="n">mS</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="o">/</span><span class="n">tanb</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">mZ</span><span class="p">,</span><span class="w"> </span><span class="n">gammaZ</span><span class="p">,</span><span class="w"> </span><span class="n">sinW2</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="n">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">std</span><span class="o">::</span><span class="n">max_element</span><span class="p">(</span><span class="n">xsecs</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">xsecs</span><span class="p">.</span><span class="n">end</span><span class="p">());</span><span class="w"></span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="n">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">std</span><span class="o">::</span><span class="n">min_element</span><span class="p">(</span><span class="n">xsecs</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">xsecs</span><span class="p">.</span><span class="n">end</span><span class="p">());</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">get_sigma_ee_chipm</span><span class="p">(</span><span class="n">triplet</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">chi_plus</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">chi_minus</span><span class="p">,</span><span class="w"></span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">tol</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">pt_error</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Spectrum</span><span class="o">&amp;</span><span class="w"> </span><span class="n">spec</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">gammaZ</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Subspectrum</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">SubSpectrum</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mssm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">get_HE</span><span class="p">();</span><span class="w"></span>

<span class="w">      </span><span class="c1">// PDG codes</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000023</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">chi_plus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">chi_plus</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="mi">1000023</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">chi_minus</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">chi_minus</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// SM parameters</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">g2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">dimensionless</span><span class="p">,</span><span class="s">&quot;g2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">sinW2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">dimensionless</span><span class="p">,</span><span class="s">&quot;sinW2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.25</span><span class="o">*</span><span class="n">sinW2</span><span class="o">*</span><span class="n">g2</span><span class="o">*</span><span class="n">g2</span><span class="o">/</span><span class="n">pi</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// MSSM parameters</span>
<span class="w">      </span><span class="c1">// Get the mass eigenstate best corresponding to ~nu_e_L.</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="n">mass_snue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slhahelp</span><span class="o">::</span><span class="n">mass_es_from_gauge_es</span><span class="p">(</span><span class="s">&quot;~nu_e_L&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mssm</span><span class="p">,</span><span class="w"> </span><span class="n">tol</span><span class="p">,</span><span class="w"> </span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="n">pt_error</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Get the electron sneutrino mass</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">msn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass</span><span class="p">,</span><span class="n">mass_snue</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Get the chargino masses</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass</span><span class="p">,</span><span class="n">id1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass</span><span class="p">,</span><span class="n">id2</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m1_uncerts</span><span class="p">(</span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass_1srd_high</span><span class="p">,</span><span class="w"> </span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">                                          </span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass_1srd_low</span><span class="p">,</span><span class="w">  </span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m2_uncerts</span><span class="p">(</span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass_1srd_high</span><span class="p">,</span><span class="w"> </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">                                          </span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass_1srd_low</span><span class="p">,</span><span class="w">  </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Just return zero if the final state is kinematically inaccessible</span>
<span class="w">      </span><span class="c1">// *even* if both masses are 2simga lower than their central values</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0-2.0</span><span class="o">*</span><span class="n">m1_uncerts</span><span class="p">.</span><span class="n">second</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0-2.0</span><span class="o">*</span><span class="n">m2_uncerts</span><span class="p">.</span><span class="n">second</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">sqrts</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">central</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Get the 2x2 chargino mixing matrices</span>
<span class="w">      </span><span class="n">MixMatrix</span><span class="w"> </span><span class="n">charginomixV</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">MixMatrix</span><span class="w"> </span><span class="n">charginomixU</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">charginomixV</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mixing</span><span class="p">,</span><span class="s">&quot;~chi+&quot;</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">charginomixU</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mssm</span><span class="p">.</span><span class="n">safeget</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mixing</span><span class="p">,</span><span class="s">&quot;~chi-&quot;</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Convert chargino mixing matrices to BFM convention</span>
<span class="w">      </span><span class="n">SLHA2BFM_VV</span><span class="p">(</span><span class="n">charginomixV</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">SLHA2BFM_VV</span><span class="p">(</span><span class="n">charginomixU</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Calculate the cross-section</span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="n">central</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsec_chaichaj</span><span class="p">(</span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="p">,</span><span class="w"> </span><span class="n">m2</span><span class="p">,</span><span class="w"> </span><span class="n">charginomixV</span><span class="p">,</span><span class="w"> </span><span class="n">charginomixU</span><span class="p">,</span><span class="w"></span>
<span class="w">                                     </span><span class="n">msn</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">mZ</span><span class="p">,</span><span class="w"> </span><span class="n">gammaZ</span><span class="p">,</span><span class="w"> </span><span class="n">sinW2</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Calculate the uncertainty on the cross-section due to final state masses varying by +/- 1 sigma</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">xsecs</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">xsecs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">central</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">xsecs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">xsec_chaichaj</span><span class="p">(</span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">m1_uncerts</span><span class="p">.</span><span class="n">first</span><span class="p">),</span><span class="w"> </span><span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">m2_uncerts</span><span class="p">.</span><span class="n">first</span><span class="p">),</span><span class="w"> </span><span class="n">charginomixV</span><span class="p">,</span><span class="w"> </span><span class="n">charginomixU</span><span class="p">,</span><span class="w"></span>
<span class="w">                                     </span><span class="n">msn</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">mZ</span><span class="p">,</span><span class="w"> </span><span class="n">gammaZ</span><span class="p">,</span><span class="w"> </span><span class="n">sinW2</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">xsecs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">xsec_chaichaj</span><span class="p">(</span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">m1_uncerts</span><span class="p">.</span><span class="n">first</span><span class="p">),</span><span class="w"> </span><span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">m2_uncerts</span><span class="p">.</span><span class="n">second</span><span class="p">),</span><span class="w"> </span><span class="n">charginomixV</span><span class="p">,</span><span class="w"> </span><span class="n">charginomixU</span><span class="p">,</span><span class="w"></span>
<span class="w">                                     </span><span class="n">msn</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">mZ</span><span class="p">,</span><span class="w"> </span><span class="n">gammaZ</span><span class="p">,</span><span class="w"> </span><span class="n">sinW2</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">xsecs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">xsec_chaichaj</span><span class="p">(</span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">m1_uncerts</span><span class="p">.</span><span class="n">second</span><span class="p">),</span><span class="w"> </span><span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">m2_uncerts</span><span class="p">.</span><span class="n">first</span><span class="p">),</span><span class="w"> </span><span class="n">charginomixV</span><span class="p">,</span><span class="w"> </span><span class="n">charginomixU</span><span class="p">,</span><span class="w"></span>
<span class="w">                                     </span><span class="n">msn</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">mZ</span><span class="p">,</span><span class="w"> </span><span class="n">gammaZ</span><span class="p">,</span><span class="w"> </span><span class="n">sinW2</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">xsecs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">xsec_chaichaj</span><span class="p">(</span><span class="n">id1</span><span class="p">,</span><span class="w"> </span><span class="n">id2</span><span class="p">,</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">m1_uncerts</span><span class="p">.</span><span class="n">second</span><span class="p">),</span><span class="w"> </span><span class="n">m2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">m2_uncerts</span><span class="p">.</span><span class="n">second</span><span class="p">),</span><span class="w"> </span><span class="n">charginomixV</span><span class="p">,</span><span class="w"> </span><span class="n">charginomixU</span><span class="p">,</span><span class="w"></span>
<span class="w">                                     </span><span class="n">msn</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">mZ</span><span class="p">,</span><span class="w"> </span><span class="n">gammaZ</span><span class="p">,</span><span class="w"> </span><span class="n">sinW2</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="n">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">std</span><span class="o">::</span><span class="n">max_element</span><span class="p">(</span><span class="n">xsecs</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">xsecs</span><span class="p">.</span><span class="n">end</span><span class="p">());</span><span class="w"></span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="n">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">std</span><span class="o">::</span><span class="n">min_element</span><span class="p">(</span><span class="n">xsecs</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">xsecs</span><span class="p">.</span><span class="n">end</span><span class="p">());</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="nf">I1</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mk</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">ml</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">m1</span><span class="o">+</span><span class="n">m2</span><span class="p">))</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">m1</span><span class="o">-</span><span class="n">m2</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">m1sq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">m1</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">m2sq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">m2</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">mksq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">mk</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">mlsq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">ml</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">I1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Careful with degenerate masses!</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">fabs</span><span class="p">(</span><span class="n">mksq</span><span class="o">-</span><span class="n">mlsq</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.1</span><span class="w"> </span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="n">I1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">m1sq</span><span class="o">+</span><span class="n">m2sq</span><span class="mf">-2.</span><span class="o">*</span><span class="n">mksq</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">log</span><span class="p">((</span><span class="n">m1sq</span><span class="o">+</span><span class="n">m2sq</span><span class="mf">-2.</span><span class="o">*</span><span class="n">mksq</span><span class="o">-</span><span class="n">s</span><span class="o">+</span><span class="n">S</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">m1sq</span><span class="o">+</span><span class="n">m2sq</span><span class="mf">-2.</span><span class="o">*</span><span class="n">mksq</span><span class="o">-</span><span class="n">s</span><span class="o">-</span><span class="n">S</span><span class="p">))</span><span class="mi">-4</span><span class="o">*</span><span class="n">S</span><span class="o">*</span><span class="p">((</span><span class="n">m1sq</span><span class="o">-</span><span class="n">mksq</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">m2sq</span><span class="o">-</span><span class="n">mksq</span><span class="p">)</span><span class="o">+</span><span class="n">mksq</span><span class="o">*</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">m1sq</span><span class="o">+</span><span class="n">m2sq</span><span class="mf">-2.</span><span class="o">*</span><span class="n">mksq</span><span class="o">-</span><span class="n">s</span><span class="o">-</span><span class="n">S</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">m1sq</span><span class="o">+</span><span class="n">m2sq</span><span class="mf">-2.</span><span class="o">*</span><span class="n">mksq</span><span class="o">-</span><span class="n">s</span><span class="o">+</span><span class="n">S</span><span class="p">)</span><span class="o">-</span><span class="n">S</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">I1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">m1sq</span><span class="o">*</span><span class="p">(</span><span class="n">m2sq</span><span class="o">-</span><span class="n">mksq</span><span class="p">)</span><span class="o">+</span><span class="n">mksq</span><span class="o">*</span><span class="p">(</span><span class="n">mksq</span><span class="o">-</span><span class="n">m2sq</span><span class="o">+</span><span class="n">s</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">mksq</span><span class="o">-</span><span class="n">mlsq</span><span class="p">)</span><span class="o">*</span><span class="n">log</span><span class="p">((</span><span class="n">m1sq</span><span class="o">+</span><span class="n">m2sq</span><span class="mf">-2.</span><span class="o">*</span><span class="n">mksq</span><span class="o">-</span><span class="n">s</span><span class="o">-</span><span class="n">S</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">m1sq</span><span class="o">+</span><span class="n">m2sq</span><span class="mf">-2.</span><span class="o">*</span><span class="n">mksq</span><span class="o">-</span><span class="n">s</span><span class="o">+</span><span class="n">S</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">I1</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">m1sq</span><span class="o">*</span><span class="p">(</span><span class="n">m2sq</span><span class="o">-</span><span class="n">mlsq</span><span class="p">)</span><span class="o">+</span><span class="n">mlsq</span><span class="o">*</span><span class="p">(</span><span class="n">mlsq</span><span class="o">-</span><span class="n">m2sq</span><span class="o">+</span><span class="n">s</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">mlsq</span><span class="o">-</span><span class="n">mksq</span><span class="p">)</span><span class="o">*</span><span class="n">log</span><span class="p">((</span><span class="n">m1sq</span><span class="o">+</span><span class="n">m2sq</span><span class="mf">-2.</span><span class="o">*</span><span class="n">mlsq</span><span class="o">-</span><span class="n">s</span><span class="o">-</span><span class="n">S</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">m1sq</span><span class="o">+</span><span class="n">m2sq</span><span class="mf">-2.</span><span class="o">*</span><span class="n">mlsq</span><span class="o">-</span><span class="n">s</span><span class="o">+</span><span class="n">S</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">I1</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">S</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">I1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="nf">I2</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mk</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">ml</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">m1</span><span class="o">+</span><span class="n">m2</span><span class="p">))</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">m1</span><span class="o">-</span><span class="n">m2</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">m1sq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">m1</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">m2sq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">m2</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">mksq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">mk</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">mlsq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">ml</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">I2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Careful with degenerate masses!</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">fabs</span><span class="p">(</span><span class="n">mksq</span><span class="o">-</span><span class="n">mlsq</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.1</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">I2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S</span><span class="o">/</span><span class="p">(</span><span class="n">m1sq</span><span class="o">*</span><span class="p">(</span><span class="n">m2sq</span><span class="o">-</span><span class="n">mksq</span><span class="p">)</span><span class="o">+</span><span class="n">mksq</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">m2sq</span><span class="o">+</span><span class="n">mksq</span><span class="o">+</span><span class="n">s</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">I2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">log</span><span class="p">((</span><span class="n">m1sq</span><span class="o">+</span><span class="n">m2sq</span><span class="mf">-2.</span><span class="o">*</span><span class="n">mksq</span><span class="o">-</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">S</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">m1sq</span><span class="o">+</span><span class="n">m2sq</span><span class="mf">-2.</span><span class="o">*</span><span class="n">mksq</span><span class="o">-</span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="n">S</span><span class="p">)));</span><span class="w"></span>
<span class="w">        </span><span class="n">I2</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">log</span><span class="p">((</span><span class="n">m1sq</span><span class="o">+</span><span class="n">m2sq</span><span class="mf">-2.</span><span class="o">*</span><span class="n">mlsq</span><span class="o">-</span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="n">S</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">m1sq</span><span class="o">+</span><span class="n">m2sq</span><span class="mf">-2.</span><span class="o">*</span><span class="n">mlsq</span><span class="o">-</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">S</span><span class="p">)));</span><span class="w"></span>
<span class="w">        </span><span class="n">I2</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">mksq</span><span class="o">-</span><span class="n">mlsq</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">I2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="nf">I3</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mk</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">m1</span><span class="o">+</span><span class="n">m2</span><span class="p">))</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">m1</span><span class="o">-</span><span class="n">m2</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">m1sq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">m1</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">m2sq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">m2</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">mksq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">mk</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">I3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">I3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">log</span><span class="p">((</span><span class="n">m1sq</span><span class="o">+</span><span class="n">m2sq</span><span class="mf">-2.</span><span class="o">*</span><span class="n">mksq</span><span class="o">-</span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="n">S</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">m1sq</span><span class="o">+</span><span class="n">m2sq</span><span class="mf">-2.</span><span class="o">*</span><span class="n">mksq</span><span class="o">-</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">S</span><span class="p">)));</span><span class="w"></span>
<span class="w">      </span><span class="n">I3</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">m1sq</span><span class="o">*</span><span class="p">(</span><span class="n">m2sq</span><span class="o">-</span><span class="n">mksq</span><span class="p">)</span><span class="o">+</span><span class="n">mksq</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">m2sq</span><span class="o">+</span><span class="n">mksq</span><span class="o">+</span><span class="n">s</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">I3</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">m1sq</span><span class="o">+</span><span class="n">m2sq</span><span class="mf">-2.</span><span class="o">*</span><span class="n">mksq</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">S</span><span class="o">/</span><span class="mf">2.</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">I3</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>


<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="nf">xsec_sleislej</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pid1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pid2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m2</span><span class="p">,</span><span class="w"> </span><span class="n">MixMatrix</span><span class="w"> </span><span class="n">F</span><span class="p">,</span><span class="w"></span>
<span class="w">                         </span><span class="n">MixMatrix</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mN</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mZ</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">gZ</span><span class="p">,</span><span class="w"></span>
<span class="w">                         </span><span class="kt">double</span><span class="w"> </span><span class="n">sin2thetaW</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">CP_lock</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Just return zero if the final state isn&#39;t kinematically accessible</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m1</span><span class="o">+</span><span class="n">m2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">sqrts</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Slepton mixing</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">cosphi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">sinphi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Figure out what we are calculating</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">tempphi</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">bool</span><span class="w"> </span><span class="n">bMixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">bool</span><span class="w"> </span><span class="n">bSelectron</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">// ~e_L ~e_L^*</span>
<span class="w">      </span><span class="k">if</span><span class="p">((</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000011</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1000011</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1000011</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000011</span><span class="p">)){</span><span class="w"></span>
<span class="w">        </span><span class="n">bSelectron</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">m1</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">m2</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">CP_lock</span><span class="p">)</span><span class="w"> </span><span class="n">ColliderBit_warning</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;You are using a different mass for antiparticle!&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="c1">// ~e_L ~e_R^*</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">((</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000011</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-2000011</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-2000011</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000011</span><span class="p">)){</span><span class="w"></span>
<span class="w">        </span><span class="n">bSelectron</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">bMixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="c1">// ~e_R ~e_L^*</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">((</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2000011</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1000011</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1000011</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2000011</span><span class="p">)){</span><span class="w"></span>
<span class="w">        </span><span class="n">bSelectron</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">bMixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="c1">// ~e_R ~e_R^*</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">((</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2000011</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-2000011</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-2000011</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2000011</span><span class="p">)){</span><span class="w"></span>
<span class="w">        </span><span class="n">bSelectron</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">tempphi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cosphi</span><span class="p">;</span><span class="w"> </span><span class="n">cosphi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sinphi</span><span class="p">;</span><span class="w"> </span><span class="n">sinphi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tempphi</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">m1</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">m2</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">CP_lock</span><span class="p">)</span><span class="w"> </span><span class="n">ColliderBit_warning</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;You are using a different mass for antiparticle!&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="c1">// ~mu_L ~mu_L^*</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">((</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000013</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1000013</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1000013</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000013</span><span class="p">)){</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">m1</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">m2</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">CP_lock</span><span class="p">)</span><span class="w"> </span><span class="n">ColliderBit_warning</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;You are using a different mass for antiparticle!&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="c1">// ~mu_L ~mu_R^*</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">((</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000013</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-2000013</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-2000013</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000013</span><span class="p">)){</span><span class="w"></span>
<span class="w">        </span><span class="n">bMixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">ColliderBit_warning</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Will give zero cross section unless there is left-right smuon mixing!&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="c1">// ~mu_R ~mu_L^*</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">((</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2000013</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1000013</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1000013</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2000013</span><span class="p">)){</span><span class="w"></span>
<span class="w">        </span><span class="n">bMixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">ColliderBit_warning</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Will give zero cross section unless there is left-right smuon mixing!&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="c1">// ~mu_R ~mu_R^*</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">((</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2000013</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-2000013</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-2000013</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2000013</span><span class="p">)){</span><span class="w"></span>
<span class="w">        </span><span class="n">tempphi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cosphi</span><span class="p">;</span><span class="w"> </span><span class="n">cosphi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sinphi</span><span class="p">;</span><span class="w"> </span><span class="n">sinphi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tempphi</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">m1</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">m2</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">CP_lock</span><span class="p">)</span><span class="w"> </span><span class="n">ColliderBit_warning</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;You are using a different mass for antiparticle!&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="c1">// ~tau_1 ~tau_1^*</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">((</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000015</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1000015</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1000015</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000015</span><span class="p">)){</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">m1</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">m2</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">CP_lock</span><span class="p">)</span><span class="w"> </span><span class="n">ColliderBit_warning</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;You are using a different mass for antiparticle!&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="c1">// ~tau_1 ~tau_2^*</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">((</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000015</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-2000015</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-2000015</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000015</span><span class="p">)){</span><span class="w"></span>
<span class="w">        </span><span class="n">bMixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="c1">// ~tau_2 ~tau_1^*</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">((</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2000015</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1000015</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1000015</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2000015</span><span class="p">)){</span><span class="w"></span>
<span class="w">        </span><span class="n">bMixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="c1">// ~tau_2 ~tau_2^*</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">((</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2000015</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-2000015</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-2000015</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2000015</span><span class="p">)){</span><span class="w"></span>
<span class="w">        </span><span class="n">tempphi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cosphi</span><span class="p">;</span><span class="w"> </span><span class="n">cosphi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sinphi</span><span class="p">;</span><span class="w"> </span><span class="n">sinphi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tempphi</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">m1</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">m2</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">CP_lock</span><span class="p">)</span><span class="w"> </span><span class="n">ColliderBit_warning</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;You are using a different mass for antiparticle!&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="n">ss</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">ss</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;I don&#39;t know that process!&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="w"></span>
<span class="w">           </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;You asked me to calculate slepton cross section with final states&quot;</span><span class="w"></span>
<span class="w">           </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;PID1 &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">pid1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; PID2 &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">pid2</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">ColliderBit_warning</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Couplings</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">T3l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-0.5</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">Le</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T3l</span><span class="o">+</span><span class="n">sin2thetaW</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">Re</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sin2thetaW</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Left-right mixing</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">cos2phi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">cosphi</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">sin2phi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">sinphi</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">fL</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="n">fR</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="n">fL</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">T3l</span><span class="o">+</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="n">fR</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">sin2thetaW</span><span class="p">))</span><span class="o">*</span><span class="n">N</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">N</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Kinematics</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="p">,</span><span class="w"> </span><span class="n">DZ2</span><span class="p">,</span><span class="w"> </span><span class="n">ReDZ</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">sqrts</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">S</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">m1</span><span class="o">+</span><span class="n">m2</span><span class="p">))</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">m1</span><span class="o">-</span><span class="n">m2</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">DZ2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">pow2</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">mZ</span><span class="p">))</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">mZ</span><span class="o">*</span><span class="n">gZ</span><span class="p">));</span><span class="w"> </span><span class="c1">// Breit-Wigner for Z</span>
<span class="w">      </span><span class="n">ReDZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">mZ</span><span class="p">))</span><span class="o">*</span><span class="n">DZ2</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Cross sections per diagram and interference terms</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="n">sigma_Z</span><span class="p">,</span><span class="w"> </span><span class="n">sigma_Z_mix</span><span class="p">,</span><span class="w"> </span><span class="n">sigma_g</span><span class="p">,</span><span class="w"> </span><span class="n">sigma_gZ</span><span class="p">,</span><span class="w"> </span><span class="n">sigma_N</span><span class="p">,</span><span class="w"> </span><span class="n">sigma_N_mix</span><span class="p">,</span><span class="w"> </span><span class="n">sigma_gN</span><span class="p">,</span><span class="w"> </span><span class="n">sigma_ZN</span><span class="p">,</span><span class="w"> </span><span class="n">sigma_ZN_mix</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">// gamma</span>
<span class="w">      </span><span class="n">sigma_g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="n">pow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mf">6.</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Z</span>
<span class="w">      </span><span class="n">sigma_Z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="n">DZ2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mf">6.</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_Z</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="p">(</span><span class="n">pow2</span><span class="p">(</span><span class="n">Le</span><span class="p">)</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">Re</span><span class="p">))</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">Le</span><span class="o">*</span><span class="n">cos2phi</span><span class="o">+</span><span class="n">Re</span><span class="o">*</span><span class="n">sin2phi</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_Z_mix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigma_Z</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">Le</span><span class="o">*</span><span class="n">cos2phi</span><span class="o">+</span><span class="n">Re</span><span class="o">*</span><span class="n">sin2phi</span><span class="p">)</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">Le</span><span class="o">-</span><span class="n">Re</span><span class="p">)</span><span class="o">*</span><span class="n">cos2phi</span><span class="o">*</span><span class="n">sin2phi</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Interference</span>
<span class="w">      </span><span class="n">sigma_gZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="n">pow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">sin2thetaW</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ReDZ</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_gZ</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="p">(</span><span class="n">Le</span><span class="o">+</span><span class="n">Re</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Le</span><span class="o">*</span><span class="n">cos2phi</span><span class="o">+</span><span class="n">Re</span><span class="o">*</span><span class="n">sin2phi</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mf">6.</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Neutralino</span>
<span class="w">      </span><span class="c1">// Loop over neutralinos</span>
<span class="w">      </span><span class="n">sigma_N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">l</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">          </span><span class="n">sigma_N</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">cos2phi</span><span class="p">)</span><span class="o">*</span><span class="n">I1</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">mN</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">mN</span><span class="p">[</span><span class="n">l</span><span class="p">])</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">fL</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">fL</span><span class="p">[</span><span class="n">l</span><span class="p">]);</span><span class="w"></span>
<span class="w">          </span><span class="n">sigma_N</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">sin2phi</span><span class="p">)</span><span class="o">*</span><span class="n">I1</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">mN</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">mN</span><span class="p">[</span><span class="n">l</span><span class="p">])</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">fR</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">fR</span><span class="p">[</span><span class="n">l</span><span class="p">]);</span><span class="w"></span>
<span class="w">          </span><span class="n">sigma_N</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">2.</span><span class="o">*</span><span class="n">cos2phi</span><span class="o">*</span><span class="n">sin2phi</span><span class="o">*</span><span class="n">s</span><span class="o">*</span><span class="n">mN</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">mN</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">I2</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">mN</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">mN</span><span class="p">[</span><span class="n">l</span><span class="p">])</span><span class="o">*</span><span class="n">fL</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">fL</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">fR</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">fR</span><span class="p">[</span><span class="n">l</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_N</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">pi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_N_mix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">l</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">sigma_N_mix</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">cos2phi</span><span class="o">*</span><span class="n">sin2phi</span><span class="o">*</span><span class="n">I1</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">mN</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">mN</span><span class="p">[</span><span class="n">l</span><span class="p">])</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">fL</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">fL</span><span class="p">[</span><span class="n">l</span><span class="p">]);</span><span class="w"></span>
<span class="w">          </span><span class="n">sigma_N_mix</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">cos2phi</span><span class="o">*</span><span class="n">sin2phi</span><span class="o">*</span><span class="n">I1</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">mN</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">mN</span><span class="p">[</span><span class="n">l</span><span class="p">])</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">fR</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">fR</span><span class="p">[</span><span class="n">l</span><span class="p">]);</span><span class="w"></span>
<span class="w">          </span><span class="n">sigma_N_mix</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">pow2</span><span class="p">(</span><span class="n">cos2phi</span><span class="p">)</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">sin2phi</span><span class="p">))</span><span class="o">*</span><span class="n">s</span><span class="o">*</span><span class="n">mN</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">mN</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">I2</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">mN</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">mN</span><span class="p">[</span><span class="n">l</span><span class="p">])</span><span class="o">*</span><span class="n">fL</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">fL</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">fR</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">fR</span><span class="p">[</span><span class="n">l</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_N_mix</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">pi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="mf">4.</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Neutralino interference terms</span>
<span class="w">      </span><span class="n">sigma_gN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="n">sigma_gN</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">I3</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">mN</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">cos2phi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">fL</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">+</span><span class="n">sin2phi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">fR</span><span class="p">[</span><span class="n">k</span><span class="p">]));</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_gN</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">pi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="n">sin2thetaW</span><span class="o">/</span><span class="n">pow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_ZN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="n">sigma_ZN</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">I3</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">mN</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">Le</span><span class="o">*</span><span class="n">cos2phi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">fL</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">+</span><span class="n">Re</span><span class="o">*</span><span class="n">sin2phi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">fR</span><span class="p">[</span><span class="n">k</span><span class="p">]));</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_ZN</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">pi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Le</span><span class="o">*</span><span class="n">cos2phi</span><span class="o">+</span><span class="n">Re</span><span class="o">*</span><span class="n">sin2phi</span><span class="p">)</span><span class="o">*</span><span class="n">ReDZ</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_ZN_mix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="n">sigma_ZN_mix</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">I3</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">mN</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">Le</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">fL</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">-</span><span class="n">Re</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">fR</span><span class="p">[</span><span class="n">k</span><span class="p">]));</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_ZN_mix</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">pi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">sin2phi</span><span class="o">*</span><span class="n">cos2phi</span><span class="o">*</span><span class="p">(</span><span class="n">Le</span><span class="o">-</span><span class="n">Re</span><span class="p">)</span><span class="o">*</span><span class="n">ReDZ</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Total cross section</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">bMixed</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigma_Z_mix</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigma_g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sigma_Z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sigma_gZ</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">bSelectron</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">bMixed</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">sigma_N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sigma_gN</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sigma_ZN</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">bSelectron</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">bMixed</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">sigma_N_mix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sigma_ZN_mix</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Fix units</span>
<span class="w">      </span><span class="n">sigma</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">gev2pb</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Return zero in corner cases where numerical roundoff has sent sigma negative.</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="nf">xsec_neuineuj</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pid1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pid2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mi</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mj</span><span class="p">,</span><span class="w"> </span><span class="n">MixMatrix</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"></span>
<span class="w">                         </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mS</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">tanb</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mZ</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">gZ</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">sin2thetaW</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Just return zero if the final state isn&#39;t kinematically accessible</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">mi</span><span class="p">)</span><span class="o">+</span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">mj</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">sqrts</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Translate from PDG codes to neutralino indices (starting at zero)</span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000022</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000023</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000025</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000035</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="n">ss</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">ss</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Invalid final state neutralino PDG code &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">pid1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">ColliderBit_error</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000022</span><span class="p">)</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000023</span><span class="p">)</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000025</span><span class="p">)</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000035</span><span class="p">)</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="n">ss</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">ss</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Invalid final state neutralino PDG code &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">pid2</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">ColliderBit_error</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Set slepton masses</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">msL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mS</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">msR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mS</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Couplings</span>
<span class="w">      </span><span class="c1">// e = g \sin\theta_W = g&#39; \cos\theta_W</span>
<span class="w">      </span><span class="c1">// alpha = e^2 / 4\pi</span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">deltaij</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="n">deltaij</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">cos2b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">tanb</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">tanb</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">sin2b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.</span><span class="o">*</span><span class="n">tanb</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">tanb</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">T3l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-0.5</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">Le</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T3l</span><span class="o">+</span><span class="n">sin2thetaW</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">Re</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sin2thetaW</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">OL</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">4</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">l</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">          </span><span class="n">OL</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">N</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">N</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">N</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span><span class="o">*</span><span class="n">cos2b</span><span class="mf">-0.5</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">N</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">N</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">N</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">sin2b</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">fL</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="n">fR</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="n">fL</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">Le</span><span class="o">*</span><span class="n">N</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">+</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="n">fR</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">sin2thetaW</span><span class="p">))</span><span class="o">*</span><span class="n">N</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">N</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Kinematics</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">Ei</span><span class="p">,</span><span class="w"> </span><span class="n">Ej</span><span class="p">,</span><span class="w"> </span><span class="n">DZ2</span><span class="p">,</span><span class="w"> </span><span class="n">ReDZ</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">sqrts</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">DZ2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">pow2</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">mZ</span><span class="p">))</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">mZ</span><span class="o">*</span><span class="n">gZ</span><span class="p">));</span><span class="w"> </span><span class="c1">// Breit-Wigner for Z</span>
<span class="w">      </span><span class="n">ReDZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">mZ</span><span class="p">))</span><span class="o">*</span><span class="n">DZ2</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">Ei</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">mi</span><span class="p">)</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">mj</span><span class="p">))</span><span class="o">/</span><span class="mf">2.</span><span class="o">/</span><span class="n">sqrts</span><span class="p">;</span><span class="w">  </span><span class="c1">// Energy of \tilde\chi^0_i in e+e- CoM system</span>
<span class="w">      </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">pow2</span><span class="p">(</span><span class="n">Ei</span><span class="p">)</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">mi</span><span class="p">));</span><span class="w">          </span><span class="c1">// Momentum of \tilde\chi^0_i in e+e- CoM system</span>
<span class="w">      </span><span class="n">Ej</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">pow2</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">mj</span><span class="p">));</span><span class="w"></span>

<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">dL</span><span class="p">,</span><span class="w"> </span><span class="n">dR</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">dL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">msL</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">mi</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">mj</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">dR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">msR</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">mi</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">mj</span><span class="p">));</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Cross sections per diagram and interference terms</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="n">sigma_Z</span><span class="p">,</span><span class="w"> </span><span class="n">sigma_s</span><span class="p">,</span><span class="w"> </span><span class="n">sigma_Zs</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Z</span>
<span class="w">      </span><span class="n">sigma_Z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">DZ2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="o">/</span><span class="n">sqrts</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">OL</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">pow2</span><span class="p">(</span><span class="n">Le</span><span class="p">)</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">Re</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_Z</span><span class="w"> </span><span class="o">*=</span><span class="w">  </span><span class="n">Ei</span><span class="o">*</span><span class="n">Ej</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="mf">3.</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">-</span><span class="n">mi</span><span class="o">*</span><span class="n">mj</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">// selectrons</span>
<span class="w">      </span><span class="n">sigma_s</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">fL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">fL</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="n">Ei</span><span class="o">*</span><span class="n">Ej</span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="n">dL</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">dL</span><span class="p">)</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="n">sqrts</span><span class="o">/</span><span class="n">q</span><span class="o">*</span><span class="p">(</span><span class="mf">1.-2.</span><span class="o">*</span><span class="n">dL</span><span class="o">-</span><span class="n">mi</span><span class="o">*</span><span class="n">mj</span><span class="o">/</span><span class="n">s</span><span class="o">/</span><span class="n">dL</span><span class="p">)</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">fabs</span><span class="p">((</span><span class="n">dL</span><span class="o">+</span><span class="n">q</span><span class="o">/</span><span class="n">sqrts</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dL</span><span class="o">-</span><span class="n">q</span><span class="o">/</span><span class="n">sqrts</span><span class="p">))));</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_s</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">fR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">fR</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="n">Ei</span><span class="o">*</span><span class="n">Ej</span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="n">dR</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">dR</span><span class="p">)</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="n">sqrts</span><span class="o">/</span><span class="n">q</span><span class="o">*</span><span class="p">(</span><span class="mf">1.-2.</span><span class="o">*</span><span class="n">dR</span><span class="o">-</span><span class="n">mi</span><span class="o">*</span><span class="n">mj</span><span class="o">/</span><span class="n">s</span><span class="o">/</span><span class="n">dR</span><span class="p">)</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">fabs</span><span class="p">((</span><span class="n">dR</span><span class="o">+</span><span class="n">q</span><span class="o">/</span><span class="n">sqrts</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dR</span><span class="o">-</span><span class="n">q</span><span class="o">/</span><span class="n">sqrts</span><span class="p">))));</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_s</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">pi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="o">/</span><span class="n">s</span><span class="o">/</span><span class="n">sqrts</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Interference</span>
<span class="w">      </span><span class="n">sigma_Zs</span><span class="w">  </span><span class="o">=</span><span class="w">  </span><span class="n">Le</span><span class="o">*</span><span class="n">fL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">fL</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">q</span><span class="o">/</span><span class="n">sqrts</span><span class="o">*</span><span class="p">(</span><span class="n">Ei</span><span class="o">*</span><span class="n">Ej</span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="n">dL</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">dL</span><span class="p">)</span><span class="o">-</span><span class="n">mi</span><span class="o">*</span><span class="n">mj</span><span class="p">)</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">fabs</span><span class="p">((</span><span class="n">dL</span><span class="o">+</span><span class="n">q</span><span class="o">/</span><span class="n">sqrts</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dL</span><span class="o">-</span><span class="n">q</span><span class="o">/</span><span class="n">sqrts</span><span class="p">)))</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">dL</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_Zs</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">-</span><span class="n">Re</span><span class="o">*</span><span class="n">fR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">fR</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">q</span><span class="o">/</span><span class="n">sqrts</span><span class="o">*</span><span class="p">(</span><span class="n">Ei</span><span class="o">*</span><span class="n">Ej</span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="n">dR</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">dR</span><span class="p">)</span><span class="o">-</span><span class="n">mi</span><span class="o">*</span><span class="n">mj</span><span class="p">)</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">fabs</span><span class="p">((</span><span class="n">dR</span><span class="o">+</span><span class="n">q</span><span class="o">/</span><span class="n">sqrts</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dR</span><span class="o">-</span><span class="n">q</span><span class="o">/</span><span class="n">sqrts</span><span class="p">)))</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">dR</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_Zs</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mf">-2.</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="o">/</span><span class="n">sqrts</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ReDZ</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">OL</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Total cross section</span>
<span class="w">      </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">sigma_Z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sigma_s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sigma_Zs</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">-</span><span class="n">deltaij</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Fix units</span>
<span class="w">      </span><span class="n">sigma</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">gev2pb</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Return zero in corner cases where numerical roundoff has sent sigma negative.</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>


<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="nf">xsec_chaichaj</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pid1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pid2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">sqrts</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mi</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mj</span><span class="p">,</span><span class="w"> </span><span class="n">MixMatrix</span><span class="w"> </span><span class="n">V</span><span class="p">,</span><span class="w"></span>
<span class="w">                         </span><span class="n">MixMatrix</span><span class="w"> </span><span class="n">U</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mZ</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">gZ</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">sin2thetaW</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Just return zero if the final state isn&#39;t kinematically accessible</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">mi</span><span class="p">)</span><span class="o">+</span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">mj</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">sqrts</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Translate from PDG codes to chargino indices (silly paper convention that i=2 lighter than i=1!)</span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">pid1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">pid1</span><span class="p">);</span><span class="w"> </span><span class="n">pid2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">pid2</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000024</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">pid1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000037</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="n">ss</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">ss</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Invalid final state chargino PDG code &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">pid1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">ColliderBit_error</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000024</span><span class="p">)</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">pid2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1000037</span><span class="p">)</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="n">ss</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">ss</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Invalid final state chargino PDG code &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">pid2</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">ColliderBit_error</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Couplings</span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">deltaij</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="n">deltaij</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">// e = g \sin\theta_W = g&#39; \cos\theta_W</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">T3l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-0.5</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">Le</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T3l</span><span class="o">+</span><span class="n">sin2thetaW</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">Re</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sin2thetaW</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">OL</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">OR</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">l</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">          </span><span class="n">OL</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">V</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="mf">-0.5</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">deltaij</span><span class="o">*</span><span class="n">sin2thetaW</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="n">OR</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">l</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">U</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">U</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="mf">-0.5</span><span class="o">*</span><span class="n">U</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">U</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">deltaij</span><span class="o">*</span><span class="n">sin2thetaW</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Kinematics</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">Ei</span><span class="p">,</span><span class="w"> </span><span class="n">Ej</span><span class="p">,</span><span class="w"> </span><span class="n">DZ2</span><span class="p">,</span><span class="w"> </span><span class="n">ReDZ</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow2</span><span class="p">(</span><span class="n">sqrts</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">Ei</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">mi</span><span class="p">)</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">mj</span><span class="p">))</span><span class="o">/</span><span class="mf">2.</span><span class="o">/</span><span class="n">sqrts</span><span class="p">;</span><span class="w">  </span><span class="c1">// Energy of \tilde\chi^+_i in e+e- CoM system</span>
<span class="w">      </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">pow2</span><span class="p">(</span><span class="n">Ei</span><span class="p">)</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">mi</span><span class="p">));</span><span class="w">          </span><span class="c1">// Momentum of \tilde\chi^+_i in e+e- CoM system</span>
<span class="w">      </span><span class="n">Ej</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">pow2</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">mj</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">DZ2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">pow2</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">mZ</span><span class="p">))</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">mZ</span><span class="o">*</span><span class="n">gZ</span><span class="p">));</span><span class="w"> </span><span class="c1">// Breit-Wigner for Z</span>
<span class="w">      </span><span class="n">ReDZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">mZ</span><span class="p">))</span><span class="o">*</span><span class="n">DZ2</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">aL</span><span class="p">,</span><span class="w"> </span><span class="n">bL</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">aL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span><span class="o">+</span><span class="n">s</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">mi</span><span class="p">)</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">mj</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">bL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="o">*</span><span class="n">sqrts</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">ms</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.</span><span class="o">*</span><span class="n">q</span><span class="o">*</span><span class="n">sqrts</span><span class="mf">-2.</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">aL</span><span class="o">/</span><span class="n">bL</span><span class="o">+</span><span class="p">(</span><span class="n">Ei</span><span class="o">*</span><span class="n">Ej</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">aL</span><span class="o">/</span><span class="n">bL</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="n">sqrts</span><span class="o">*</span><span class="n">aL</span><span class="o">/</span><span class="n">bL</span><span class="p">)</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">fabs</span><span class="p">((</span><span class="n">aL</span><span class="o">+</span><span class="n">bL</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">aL</span><span class="o">-</span><span class="n">bL</span><span class="p">)));</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Cross sections per diagram and interference terms</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="n">sigma_g</span><span class="p">,</span><span class="w"> </span><span class="n">sigma_Z</span><span class="p">,</span><span class="w"> </span><span class="n">sigma_s</span><span class="p">,</span><span class="w"> </span><span class="n">sigma_gZ</span><span class="p">,</span><span class="w"> </span><span class="n">sigma_gs</span><span class="p">,</span><span class="w"> </span><span class="n">sigma_Zs</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Gamma</span>
<span class="w">      </span><span class="n">sigma_g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="o">*</span><span class="n">sqrts</span><span class="o">/</span><span class="n">pow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">deltaij</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">Ei</span><span class="o">*</span><span class="n">Ej</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="mf">3.</span><span class="o">+</span><span class="n">fabs</span><span class="p">(</span><span class="n">mi</span><span class="o">*</span><span class="n">mj</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Z</span>
<span class="w">      </span><span class="n">sigma_Z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="o">/</span><span class="n">sqrts</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">DZ2</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_Z</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="p">(</span><span class="n">pow2</span><span class="p">(</span><span class="n">OL</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">OR</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]))</span><span class="o">*</span><span class="p">(</span><span class="n">pow2</span><span class="p">(</span><span class="n">Le</span><span class="p">)</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">Re</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">Ei</span><span class="o">*</span><span class="n">Ej</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">pow2</span><span class="p">(</span><span class="n">Le</span><span class="p">)</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">Re</span><span class="p">))</span><span class="o">*</span><span class="n">OL</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">OR</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">mi</span><span class="o">*</span><span class="n">mj</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Sneutrino</span>
<span class="w">      </span><span class="n">sigma_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">pow</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="o">/</span><span class="n">sqrts</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_s</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="p">(</span><span class="n">Ei</span><span class="o">*</span><span class="n">Ej</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="n">sqrts</span><span class="o">*</span><span class="n">aL</span><span class="o">/</span><span class="n">bL</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">pow2</span><span class="p">(</span><span class="n">aL</span><span class="p">)</span><span class="o">-</span><span class="n">pow2</span><span class="p">(</span><span class="n">bL</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">q</span><span class="o">/</span><span class="n">bL</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">bL</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">sqrts</span><span class="mf">-2.</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">aL</span><span class="o">/</span><span class="n">bL</span><span class="p">)</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">fabs</span><span class="p">((</span><span class="n">aL</span><span class="o">+</span><span class="n">bL</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">aL</span><span class="o">-</span><span class="n">bL</span><span class="p">)));</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Interference</span>
<span class="w">      </span><span class="n">sigma_gZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">/</span><span class="n">sin2thetaW</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="o">*</span><span class="n">sqrts</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">ReDZ</span><span class="o">*</span><span class="n">deltaij</span><span class="o">*</span><span class="p">(</span><span class="n">Le</span><span class="o">+</span><span class="n">Re</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_gZ</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="p">(</span><span class="n">OL</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">OR</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">Ei</span><span class="o">*</span><span class="n">Ej</span><span class="o">+</span><span class="n">pow2</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="mf">3.</span><span class="o">+</span><span class="n">fabs</span><span class="p">(</span><span class="n">mi</span><span class="o">*</span><span class="n">mj</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_gs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">pi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="n">sin2thetaW</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">deltaij</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_gs</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fabs</span><span class="p">(</span><span class="n">mi</span><span class="o">*</span><span class="n">mj</span><span class="p">)</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">fabs</span><span class="p">((</span><span class="n">aL</span><span class="o">+</span><span class="n">bL</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">aL</span><span class="o">-</span><span class="n">bL</span><span class="p">)));</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_Zs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">pi</span><span class="o">*</span><span class="n">pow2</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="n">pow2</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">sin2thetaW</span><span class="p">)</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ReDZ</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Le</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">sigma_Zs</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">OL</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">h</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">OR</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">mi</span><span class="o">*</span><span class="n">mj</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">fabs</span><span class="p">((</span><span class="n">aL</span><span class="o">+</span><span class="n">bL</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">aL</span><span class="o">-</span><span class="n">bL</span><span class="p">)));</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Total cross section with interference terms</span>
<span class="w">      </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigma_g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sigma_Z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sigma_s</span><span class="o">+</span><span class="w"> </span><span class="n">sigma_gZ</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sigma_gs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sigma_Zs</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Units</span>
<span class="w">      </span><span class="n">sigma</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">gev2pb</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Return zero in corner cases where numerical roundoff has sent sigma negative.</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>



<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SLHA2BFM_NN</span><span class="p">(</span><span class="n">MixMatrix</span><span class="w"> </span><span class="o">&amp;</span><span class="n">NN</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">tanb</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">sin2thetaW</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Define conversion matrix</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">sinthetaW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">costhetaW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">sin2thetaW</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">tanv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.</span><span class="o">/</span><span class="n">tanb</span><span class="p">;</span><span class="w">       </span><span class="c1">// Needed because of convention difference</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">sinv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">atan</span><span class="p">(</span><span class="n">tanv</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">cosv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">atan</span><span class="p">(</span><span class="n">tanv</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">MixMatrix</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">4</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">costhetaW</span><span class="p">;</span><span class="w"> </span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sinthetaW</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sinthetaW</span><span class="p">;</span><span class="w"> </span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">costhetaW</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sinv</span><span class="p">;</span><span class="w">   </span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cosv</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">T</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">cosv</span><span class="p">;</span><span class="w">  </span><span class="n">T</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sinv</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Multiply N_{BFM} = N_{SLHA} T</span>
<span class="w">      </span><span class="n">NN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">multiply</span><span class="p">(</span><span class="n">NN</span><span class="p">,</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SLHA2BFM_VV</span><span class="p">(</span><span class="n">MixMatrix</span><span class="w"> </span><span class="o">&amp;</span><span class="n">VV</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Define conversion matrix (\sigma_3)</span>
<span class="w">      </span><span class="n">MixMatrix</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Multiply V_{BFM} = \sigma_3 V_{SLHA}</span>
<span class="w">      </span><span class="n">VV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">multiply</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">VV</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">BFM2SLHA_NN</span><span class="p">(</span><span class="n">MixMatrix</span><span class="w"> </span><span class="o">&amp;</span><span class="n">NN</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">tanb</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">sin2thetaW</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Define conversion matrix</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">sinthetaW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">sin2thetaW</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">costhetaW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">sin2thetaW</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">tanv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.</span><span class="o">/</span><span class="n">tanb</span><span class="p">;</span><span class="w">       </span><span class="c1">// Needed because of convention difference</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">sinv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">atan</span><span class="p">(</span><span class="n">tanv</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">cosv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">atan</span><span class="p">(</span><span class="n">tanv</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">MixMatrix</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">4</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">costhetaW</span><span class="p">;</span><span class="w"> </span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sinthetaW</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sinthetaW</span><span class="p">;</span><span class="w"> </span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">costhetaW</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sinv</span><span class="p">;</span><span class="w">   </span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cosv</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">T</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">cosv</span><span class="p">;</span><span class="w">  </span><span class="n">T</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sinv</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Multiply N_{SLHA} = N_{BFM} T^T</span>
<span class="w">      </span><span class="n">NN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">multiply</span><span class="p">(</span><span class="n">NN</span><span class="p">,</span><span class="n">transpose</span><span class="p">(</span><span class="n">T</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">BFM2SLHA_VV</span><span class="p">(</span><span class="n">MixMatrix</span><span class="w"> </span><span class="o">&amp;</span><span class="n">VV</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">SLHA2BFM_VV</span><span class="p">(</span><span class="n">VV</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">MixMatrix</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="n">MixMatrix</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">MixMatrix</span><span class="w"> </span><span class="n">B</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">dim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="n">MixMatrix</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dim</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dim</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dim</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">          </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dim</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">            </span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">];</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">C</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">MixMatrix</span><span class="w"> </span><span class="nf">transpose</span><span class="p">(</span><span class="n">MixMatrix</span><span class="w"> </span><span class="n">A</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">dim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dim</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dim</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">          </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span><span class="w"></span>
<span class="w">          </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<span class="w">          </span><span class="n">A</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">A</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="n">MixMatrix</span><span class="w"> </span><span class="n">A</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">dim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Matrix dimension: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">dim</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dim</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">dim</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">){</span><span class="w"></span>
<span class="w">          </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>


<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  
<style>
  /* Sidebar header (and topbar for mobile) */
  .wy-side-nav-search, .wy-nav-top, .wy-nav-side {
    background: #efefef;
  }

  /* Sidebar text */
  .wy-menu-vertical a {
    color: #000000;
  }
</style>


</body>
</html>