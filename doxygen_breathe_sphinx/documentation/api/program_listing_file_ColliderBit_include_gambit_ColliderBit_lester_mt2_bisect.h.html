<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Program Listing for File lester_mt2_bisect.h &mdash; GAMBIT  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/collapsible-lists/css/tree_view.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  <div class="col-lg-9 col-xl-8 text-center">
    <p class="meta"><a href="/">⇦ Back to GAMBIT homepage</a></p>
  </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div> 

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../exhale_documentation/library_root.html">Library API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GAMBIT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Program Listing for File lester_mt2_bisect.h</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="program-listing-for-file-lester-mt2-bisect-h">
<span id="program-listing-file-colliderbit-include-gambit-colliderbit-lester-mt2-bisect-h"></span><h1>Program Listing for File lester_mt2_bisect.h<a class="headerlink" href="#program-listing-for-file-lester-mt2-bisect-h" title="Permalink to this headline"></a></h1>
<p>↰ <a class="reference internal" href="../exhale_documentation/file_ColliderBit_include_gambit_ColliderBit_lester_mt2_bisect.h.html#file-colliderbit-include-gambit-colliderbit-lester-mt2-bisect-h"><span class="std std-ref">Return to documentation for file</span></a> (<code class="docutils literal notranslate"><span class="pre">ColliderBit/include/gambit/ColliderBit/lester_mt2_bisect.h</span></code>)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> *  Copyright 2014, Christopher Lester, Univeristy of Cambridge</span>
<span class="cm"> *</span>
<span class="cm"> *  version 5: arXiv:1411.4312v5</span>
<span class="cm"> *    * made more portable by removal of use of __FILE__ and __LINE__ macros in debug statement</span>
<span class="cm"> *    * made fewer demands on poor C++ compilers (ROOT5/CINT) by removal of certain inline statements</span>
<span class="cm"> *    * added this changelog!</span>
<span class="cm"> *</span>
<span class="cm"> *  version 4: arXiv:1411.4312v4</span>
<span class="cm"> *    * added copyright information</span>
<span class="cm"> *</span>
<span class="cm"> *  version 3: arXiv:1411.4312v3</span>
<span class="cm"> *    * added option to turn on/off deci-sectioning</span>
<span class="cm"> *    * made code slightly slower for readability gain</span>
<span class="cm"> *</span>
<span class="cm"> *  version 2: arXiv:1411.4312v2</span>
<span class="cm"> *    * no changes w.r.t. version 1</span>
<span class="cm"> *</span>
<span class="cm"> *  version 1: arXiv:1411.4312v1</span>
<span class="cm"> *    * initial public release</span>
<span class="cm"> *</span>
<span class="cm"> *  This file will let you calculate MT2 or Asymmetric MT2 relatively easily.</span>
<span class="cm"> *  An example showing how to do so, may be found below this copyright message.</span>
<span class="cm"> *</span>
<span class="cm"> *  (Note that this is a low-level library.  Various wrappers exist around</span>
<span class="cm"> *   it to allow easier interfacing to ROOT or ATLAS code.)</span>
<span class="cm"> *</span>
<span class="cm"> *   If you use this implementation, please cite:</span>
<span class="cm"> *</span>
<span class="cm"> *   http://arxiv.org/abs/1411.4312</span>
<span class="cm"> *</span>
<span class="cm"> *   as the paper documenting this particular implementation.</span>
<span class="cm"> *</span>
<span class="cm"> *   You might also need to cite:</span>
<span class="cm"> *</span>
<span class="cm"> *   http://arxiv.org/abs/hep-ph/9906349</span>
<span class="cm"> *   Journal reference: Phys.Lett.B463:99-103,1999</span>
<span class="cm"> *   DOI: 10.1016/S0370-2693(99)00945-4</span>
<span class="cm"> *</span>
<span class="cm"> *   as the paper defining MT2.</span>
<span class="cm"> *</span>
<span class="cm"> * Here is an example of it&#39;s use:</span>


<span class="cm">double mVisA = 10; // mass of visible object on side A.  Must be &gt;=0.</span>
<span class="cm">double pxA = 20; // x momentum of visible object on side A.</span>
<span class="cm">double pyA = 30; // y momentum of visible object on side A.</span>

<span class="cm">double mVisB = 10; // mass of visible object on side B.  Must be &gt;=0.</span>
<span class="cm">double pxB = -20; // x momentum of visible object on side B.</span>
<span class="cm">double pyB = -30; // y momentum of visible object on side B.</span>

<span class="cm">double pxMiss = -5; // x component of missing transverse momentum.</span>
<span class="cm">double pyMiss = -5; // y component of missing transverse momentum.</span>

<span class="cm">double chiA = 4; // hypothesised mass of invisible on side A.  Must be &gt;=0.</span>
<span class="cm">double chiB = 7; // hypothesised mass of invisible on side B.  Must be &gt;=0.</span>

<span class="cm">double desiredPrecisionOnMt2 = 0; // Must be &gt;=0.  If 0 alg aims for machine precision.  if &gt;0, MT2 computed to supplied absolute precision.</span>

<span class="cm">// asymm_mt2_lester_bisect::disableCopyrightMessage();</span>

<span class="cm">double MT2 =  asymm_mt2_lester_bisect::get_mT2(</span>
<span class="cm">           mVisA, pxA, pyA,</span>
<span class="cm">           mVisB, pxB, pyB,</span>
<span class="cm">           pxMiss, pyMiss,</span>
<span class="cm">           chiA, chiB,</span>
<span class="cm">           desiredPrecisionOnMt2);</span>

<span class="cm"> */</span><span class="w"></span>


<span class="cp">#ifndef LESTER_TESTWHETHERELLIPSESAREDISJOINT_H</span>
<span class="cp">#define LESTER_TESTWHETHERELLIPSESAREDISJOINT_H</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cmath&gt;</span><span class="c1"> // for fabs( ... )</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * The</span>
<span class="cm"> *</span>
<span class="cm"> *             bool ellipsesAreDisjoint(const EllipseParams &amp; e1, const EllipseParams &amp; e2);</span>
<span class="cm"> *</span>
<span class="cm"> * function determines whether two ellipses (not both singular) are disjoint.</span>
<span class="cm"> * Ellipses are assumed to be solid objects with a filled interior.</span>
<span class="cm"> * They are disjoint it no part of their interiors overlap.</span>
<span class="cm"> * Singular (in this context) is defined below.</span>
<span class="cm"> *</span>
<span class="cm"> * It uses the method of:</span>

<span class="cm">Computer Aided Geometric Design 23 (2006) 324–350</span>
<span class="cm">A new approach to characterizing the relative position of two ellipses depending on one parameter</span>
<span class="cm">Fernando Etayo 1,3, Laureano Gonzalez-Vega ∗,2,3, Natalia del Rio 3</span>
<span class="cm">Departamento de Matematicas, Estadistica y Computacion, Universidad de Cantabria, Spain</span>
<span class="cm">Received 15 September 2004; received in revised form 2 November 2005; accepted 10 January 2006 Available online 28 February 2006</span>

<span class="cm">pointed out to me by Gary B. Huges and Mohcine Chraibi authors of</span>

<span class="cm"> Comput Visual Sci (2012) 15:291–301 DOI 10.1007/s00791-013-0214-3</span>
<span class="cm"> Calculating ellipse overlap areas Gary B. Hughes · Mohcine Chraibi</span>

<span class="cm"> * Note:</span>
<span class="cm"> *</span>
<span class="cm"> * Though the paper above talks only about ellipses, from playing with some test cases, I (CGL) have conjectured that the algorithm actually works well even if the conics are parabolas provided that the axx&gt;0&amp;&amp;ayy&gt;0 test is reduced to axx&gt;=0&amp;&amp;ayy&gt;=0&amp;&amp;axx*ayy!=0 ... which is true is good news for the similicity of the MT2 calculator ... as the MT2 calculator will not need to distinguish these two possibilities.  In a private communication between me (CGL) and the  authors of Computer Aided Geometric Design 23 (2006) 324–350, the authors have indicated that it is not unreasonable to believe that the code does indeed work on the parabolica cases too.  This algorithm relies on that generalisation, which may be the subject of a paper (to appear) from Etayo and Gonzalez-Vega.</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Definition: an ellipse is defined with respect to cartesian co-ordinates (x,y) by an equation of the form;</span>
<span class="cm"> *</span>
<span class="cm"> * xVec^T A xVec = 0                 (1)</span>
<span class="cm"> *</span>
<span class="cm"> * where xVec is a columnar three vec containing (x,y,1) and where A is a symmetric matrix having elements:</span>
<span class="cm"> *</span>
<span class="cm"> *       [ axx axy ax  ]</span>
<span class="cm"> *   A = [ axy ayy ay  ]</span>
<span class="cm"> *       [ ax  ay  a   ].</span>
<span class="cm"> *</span>
<span class="cm"> * Therfore the ellipse equation would look like:</span>
<span class="cm"> *</span>
<span class="cm"> * axx x^2 + 2 axy x y + ayy y^2 + 2 ax x + 2 ay y + a = 0.</span>
<span class="cm"> *</span>
<span class="cm"> * Note that this parametrisation has one parameter too many ... the &quot;A&quot;-matrix can be multiplied by a non-zero constant, and the ellipse is not changed.</span>
<span class="cm"> * Etayo et al&#39;s implementation REQUIRES that axx and ayy be strictly positive.</span>
<span class="cm"> * The implementation herein doesn&#39;t quite enforce that. The implementation herein allows axx or ayy to be non-negative .... and it is left to the user to ensure that axx and ayy are not exactly zero.</span>
<span class="cm"> * Note also that (1) is general enough to contain all conic sections, so it is left to the user to ensure that only values of A consistent</span>
<span class="cm"> * with (non-singluar) ellipses are fed into the program below.  For our purposes, an ellipse is &quot;singular&quot; iff coeffLamPow3 (see below) is zero.</span>
<span class="cm"> */</span><span class="w"></span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">Lester</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="k">struct</span><span class="w"> </span><span class="nc">EllipseParams</span><span class="w"> </span><span class="p">{</span><span class="w"></span>


<span class="w">  </span><span class="c1">// Constructor for non-degenerate ellipses:</span>
<span class="w">  </span><span class="cm">/*</span>
<span class="cm">   * Ellipse is represented algebraically by:</span>
<span class="cm">   * c_xx x^2 + 2 c_xy x y + c_yy y^2 + 2 c_x x + 2 c_y y + c = 0.</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="n">EllipseParams</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">c_xx2</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">c_yy2</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">c_xy2</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">c_x2</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">c_y2</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">c2</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="n">c_xx</span><span class="p">(</span><span class="n">c_xx2</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">c_yy</span><span class="p">(</span><span class="n">c_yy2</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">c_xy</span><span class="p">(</span><span class="n">c_xy2</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">c_x</span><span class="p">(</span><span class="n">c_x2</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">c_y</span><span class="p">(</span><span class="n">c_y2</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">c</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="c1">//Etayo et al REQUIRE that c_xx and c_yy are non-negative, so:</span>
<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c_xx</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">c_yy</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="k">throw</span><span class="w"> </span><span class="s">&quot;precondition violation&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">setDet</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="n">EllipseParams</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">setDet</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">det</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">c_x</span><span class="o">*</span><span class="n">c_xy</span><span class="o">*</span><span class="n">c_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">c_xx</span><span class="o">*</span><span class="n">c_yy</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">c_yy</span><span class="o">*</span><span class="n">c_x</span><span class="o">*</span><span class="n">c_x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">c_xy</span><span class="o">*</span><span class="n">c_xy</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">c_xx</span><span class="o">*</span><span class="n">c_y</span><span class="o">*</span><span class="n">c_y</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Consstructor for degenerate ellipse (i.e. a &quot;dot&quot; at (x0,y0) ).</span>
<span class="w">  </span><span class="n">EllipseParams</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">x0</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y0</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="n">c_xx</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">c_yy</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">c_xy</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">c_x</span><span class="p">(</span><span class="o">-</span><span class="n">x0</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">c_y</span><span class="p">(</span><span class="o">-</span><span class="n">y0</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">c</span><span class="p">(</span><span class="n">x0</span><span class="o">*</span><span class="n">x0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y0</span><span class="o">*</span><span class="n">y0</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">det</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">lesterFactor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">EllipseParams</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">e2</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">EllipseParams</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">e1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">ans</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">c_xx</span><span class="o">*</span><span class="n">e1</span><span class="p">.</span><span class="n">c_yy</span><span class="o">*</span><span class="n">e2</span><span class="p">.</span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">e1</span><span class="p">.</span><span class="n">c_xy</span><span class="o">*</span><span class="n">e1</span><span class="p">.</span><span class="n">c_y</span><span class="o">*</span><span class="n">e2</span><span class="p">.</span><span class="n">c_x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">e1</span><span class="p">.</span><span class="n">c_x</span><span class="o">*</span><span class="n">e1</span><span class="p">.</span><span class="n">c_yy</span><span class="o">*</span><span class="n">e2</span><span class="p">.</span><span class="n">c_x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">c</span><span class="o">*</span><span class="n">e1</span><span class="p">.</span><span class="n">c_yy</span><span class="o">*</span><span class="n">e2</span><span class="p">.</span><span class="n">c_xx</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">e1</span><span class="p">.</span><span class="n">c</span><span class="o">*</span><span class="n">e1</span><span class="p">.</span><span class="n">c_xy</span><span class="o">*</span><span class="n">e2</span><span class="p">.</span><span class="n">c_xy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">e1</span><span class="p">.</span><span class="n">c_x</span><span class="o">*</span><span class="n">e1</span><span class="p">.</span><span class="n">c_y</span><span class="o">*</span><span class="n">e2</span><span class="p">.</span><span class="n">c_xy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">e1</span><span class="p">.</span><span class="n">c_x</span><span class="o">*</span><span class="n">e1</span><span class="p">.</span><span class="n">c_xy</span><span class="o">*</span><span class="n">e2</span><span class="p">.</span><span class="n">c_y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="n">e1</span><span class="p">.</span><span class="n">c_xx</span><span class="o">*</span><span class="n">e1</span><span class="p">.</span><span class="n">c_y</span><span class="o">*</span><span class="n">e2</span><span class="p">.</span><span class="n">c_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">c</span><span class="o">*</span><span class="n">e1</span><span class="p">.</span><span class="n">c_xx</span><span class="o">*</span><span class="n">e2</span><span class="p">.</span><span class="n">c_yy</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">c_yy</span><span class="o">*</span><span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">c_x</span><span class="o">*</span><span class="n">e1</span><span class="p">.</span><span class="n">c_x</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">c_xy</span><span class="o">*</span><span class="n">e1</span><span class="p">.</span><span class="n">c_xy</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">c_xx</span><span class="o">*</span><span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">c_y</span><span class="o">*</span><span class="n">e1</span><span class="p">.</span><span class="n">c_y</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ans</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">EllipseParams</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"></span>
<span class="w">      </span><span class="n">c_xx</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">c_xx</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">      </span><span class="n">c_yy</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">c_yy</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">      </span><span class="n">c_xy</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">c_xy</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">      </span><span class="n">c_x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">c_x</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">      </span><span class="n">c_y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">c_y</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">      </span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w"> </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Data</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">c_xx</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">c_yy</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">c_xy</span><span class="p">;</span><span class="w"> </span><span class="c1">// note factor of 2 above</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">c_x</span><span class="p">;</span><span class="w">  </span><span class="c1">// note factor of 2 above</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">c_y</span><span class="p">;</span><span class="w">  </span><span class="c1">// note factor of 2 above</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">det</span><span class="p">;</span><span class="w"> </span><span class="c1">// The determinant of the 3x3 conic matrix</span>
<span class="p">};</span><span class="w"></span>

<span class="c1">// This is the interface: users should call this function:</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">ellipsesAreDisjoint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">EllipseParams</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">e1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">EllipseParams</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">e2</span><span class="p">);</span><span class="w"></span>

<span class="c1">// This is an implementation thing: users should not call it:</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">__private_ellipsesAreDisjoint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">coeffLamPow3</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">coeffLamPow2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">coeffLamPow1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">coeffLamPow0</span><span class="p">);</span><span class="w"></span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">ellipsesAreDisjoint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">EllipseParams</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">e1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">EllipseParams</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">e2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="cm">/* We want to construct the polynomial &quot;Det(lamdba A + B)&quot; where A and B are the 3x3 matrices associated with e1 and e2, and we want to get that</span>
<span class="cm">  polynomial in the form lambda^3 + a lambda^2 + b lambda + c.</span>


<span class="cm">  Note that by default we will not have unity as the coefficient of the lambda^3 term, however the redundancy in the parametrisation of A and B allows us to scale the whole ply until the first term does have a unit coefficient.</span>
<span class="cm">  */</span><span class="w"></span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e1</span><span class="o">==</span><span class="n">e2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// Probably won&#39;t catch many cases, but may as well have it here.</span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="c1">// first get unscaled terms:</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">coeffLamPow3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">det</span><span class="p">;</span><span class="w"> </span><span class="c1">// Note that this is the determinant of the symmetric matrix associated with e1.</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">coeffLamPow2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">lesterFactor</span><span class="p">(</span><span class="n">e2</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">coeffLamPow1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">lesterFactor</span><span class="p">(</span><span class="n">e1</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">coeffLamPow0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">det</span><span class="p">;</span><span class="w"> </span><span class="c1">// Note that this is the determinant of the symmetric matrix associated with e2.</span>

<span class="w">  </span><span class="c1">// Since question is &quot;symmetric&quot; and since we need to dovide by coeffLamPow3 ... do this the way round that involves dividing by the largest number:</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">coeffLamPow3</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">fabs</span><span class="p">(</span><span class="n">coeffLamPow0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">__private_ellipsesAreDisjoint</span><span class="p">(</span><span class="n">coeffLamPow3</span><span class="p">,</span><span class="w"> </span><span class="n">coeffLamPow2</span><span class="p">,</span><span class="w"> </span><span class="n">coeffLamPow1</span><span class="p">,</span><span class="w"> </span><span class="n">coeffLamPow0</span><span class="p">);</span><span class="w"> </span><span class="c1">// normal order</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">__private_ellipsesAreDisjoint</span><span class="p">(</span><span class="n">coeffLamPow0</span><span class="p">,</span><span class="w"> </span><span class="n">coeffLamPow1</span><span class="p">,</span><span class="w"> </span><span class="n">coeffLamPow2</span><span class="p">,</span><span class="w"> </span><span class="n">coeffLamPow3</span><span class="p">);</span><span class="w"> </span><span class="c1">// reversed order</span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">__private_ellipsesAreDisjoint</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">coeffLamPow3</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">coeffLamPow2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">coeffLamPow1</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">coeffLamPow0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="c1">// precondition of being called:</span>
<span class="w">  </span><span class="c1">//assert(fabs(coeffLamPow3)&gt;=fabs(coeffLamPow0));</span>

<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">coeffLamPow3</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// The ellipses were singular in some way.</span>
<span class="w">    </span><span class="c1">// Cannot determine whether they are overlapping or not.</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="c1">// now scale terms to monomial form:</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coeffLamPow2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">coeffLamPow3</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coeffLamPow1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">coeffLamPow3</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coeffLamPow0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">coeffLamPow3</span><span class="p">;</span><span class="w"></span>

<span class="cp">#ifdef LESTER_DEEP_FIDDLE</span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">thing1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-3.0</span><span class="o">*</span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">thing2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-27.0</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">18.0</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">thing1</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &amp;&amp; &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">thing2</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &amp;&amp; [[ &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; ] or &quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;[ &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">   </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; ] =(&quot;</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">((</span><span class="n">a</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="cm">/*&amp;&amp; thing1 &gt; 0*/</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="mf">3.0</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="cm">/*&amp;&amp; thing2 &gt; 0*/</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"></span>
<span class="w">                                 </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="cm">/*&amp;&amp; thing1 &gt; 0*/</span><span class="w">                                 </span><span class="cm">/*&amp;&amp; thing2 &gt; 0*/</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;)] &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">thing1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="mf">3.0</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">thing2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"></span>
<span class="w">                                 </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">thing1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">                                 </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">thing2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"></span>

<span class="w">          </span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="w">  </span><span class="c1">// Use the main result of the above paper:</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">thing1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-3.0</span><span class="o">*</span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">thing1</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">thing2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-27.0</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">18.0</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">thing2</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="c1">// ans true means ellipses are disjoint:</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="cm">/*&amp;&amp; thing1 &gt; 0*/</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="mf">3.0</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="cm">/*&amp;&amp; thing2 &gt; 0*/</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"></span>
<span class="w">                     </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">&lt;</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="cm">/*&amp;&amp; thing1 &gt; 0*/</span><span class="w">                                 </span><span class="cm">/*&amp;&amp; thing2 &gt; 0*/</span><span class="p">));</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ans</span><span class="p">;</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="cp">#endif</span>








<span class="cp">#ifndef ASYMM_MT2_BISECT_H</span>
<span class="cp">#define ASYMM_MT2_BISECT_H</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iomanip&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cassert&gt;</span><span class="cp"></span>


<span class="k">class</span><span class="w"> </span><span class="nc">asymm_mt2_lester_bisect</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w"> </span><span class="k">public</span><span class="o">:</span><span class="w"></span>

<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MT2_ERROR</span><span class="o">=</span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="nf">get_mT2</span><span class="p">(</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">asymmetric</span><span class="w"> </span><span class="n">mT2</span><span class="w"> </span><span class="p">(</span><span class="n">which</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">negative</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="p">(</span><span class="n">such</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">MT2_ERROR</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="no">of</span><span class="w"> </span><span class="no">an</span><span class="w"> </span><span class="no">error</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">mVis1</span><span class="p">,</span><span class="w"> </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">pxVis1</span><span class="p">,</span><span class="w"> </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">pyVis1</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">mVis2</span><span class="p">,</span><span class="w"> </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">pxVis2</span><span class="p">,</span><span class="w"> </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">pyVis2</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">pxMiss</span><span class="p">,</span><span class="w"> </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">pyMiss</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">mInvis1</span><span class="p">,</span><span class="w"> </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">mInvis2</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">desiredPrecisionOnMT2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// This must be non-negative.  If set to zero (default) MT2 will be calculated to the highest precision available on the machine (or as close to that as the algorithm permits).  If set to a positive value, MT2 (note that is MT2, not its square) will be calculated to within +- desiredPrecisionOnMT2. Note that by requesting precision of +- 0.01 GeV on an MT2 value of 100 GeV can result in speedups of a factor of ...</span>
<span class="w">    </span><span class="no">const</span><span class="w"> </span><span class="no">bool</span><span class="w"> </span><span class="no">useDeciSectionsInitially</span><span class="o">=</span><span class="no">true</span><span class="w"> </span><span class="c1">// If true, interval is cut at the 10% point until first acceptance, which gives factor 3 increase in speed calculating kinematic min, but 3% slowdown for events in the bulk.  Is on (true) by default, but can be turned off by setting to false.</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mT2_Sq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_mT2_Sq</span><span class="p">(</span><span class="w"></span>
<span class="w">                            </span><span class="n">mVis1</span><span class="p">,</span><span class="w"> </span><span class="n">pxVis1</span><span class="p">,</span><span class="w"> </span><span class="n">pyVis1</span><span class="p">,</span><span class="w"></span>
<span class="w">                            </span><span class="n">mVis2</span><span class="p">,</span><span class="w"> </span><span class="n">pxVis2</span><span class="p">,</span><span class="w"> </span><span class="n">pyVis2</span><span class="p">,</span><span class="w"></span>
<span class="w">                            </span><span class="n">pxMiss</span><span class="p">,</span><span class="n">pyMiss</span><span class="p">,</span><span class="w"></span>
<span class="w">                            </span><span class="n">mInvis1</span><span class="p">,</span><span class="w"> </span><span class="n">mInvis2</span><span class="p">,</span><span class="w"></span>
<span class="w">                            </span><span class="n">desiredPrecisionOnMT2</span><span class="p">,</span><span class="w"></span>
<span class="w">                            </span><span class="n">useDeciSectionsInitially</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mT2_Sq</span><span class="o">==</span><span class="n">MT2_ERROR</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">MT2_ERROR</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">mT2_Sq</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">disableCopyrightMessage</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">printIfFirst</span><span class="o">=</span><span class="nb">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">first</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">printIfFirst</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;#=========================================================</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;# To disable this message, place a call to </span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;# </span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;#     asymm_mt2_lester_bisect::disableCopyrightMessage();</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;# </span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;# somewhere before you begin to calculate your MT2 values.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;#=========================================================</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;# You are calculating symmetric or asymmetric MT2 using</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;# the implementation defined in:</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;# </span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;#     http://arxiv.org/abs/1411.4312</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;# </span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;# Please cite the paper above if you use the MT2 values</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;# for a scholarly purpose. For the variable MT2 itself,</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;# please also cite:</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;# </span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;#     http://arxiv.org/abs/hep-ph/9906349</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;#=========================================================</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">flush</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="nf">get_mT2_Sq</span><span class="p">(</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">square</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">asymmetric</span><span class="w"> </span><span class="n">mT2</span><span class="w"> </span><span class="p">(</span><span class="n">which</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">negative</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="p">(</span><span class="n">such</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">MT2_ERROR</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="no">of</span><span class="w"> </span><span class="no">an</span><span class="w"> </span><span class="no">error</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">mVis1</span><span class="p">,</span><span class="w"> </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">pxVis1</span><span class="p">,</span><span class="w"> </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">pyVis1</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">mVis2</span><span class="p">,</span><span class="w"> </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">pxVis2</span><span class="p">,</span><span class="w"> </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">pyVis2</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">pxMiss</span><span class="p">,</span><span class="w"> </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">pyMiss</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">mInvis1</span><span class="p">,</span><span class="w"> </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">mInvis2</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="no">const</span><span class="w"> </span><span class="no">double</span><span class="w"> </span><span class="no">desiredPrecisionOnMT2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// This must be non-negative.  If set to zero (default) MT2 will be calculated to the highest precision available on the machine (or as close to that as the algorithm permits).  If set to a positive value, MT2 (note that is MT2, not its square) will be calculated to within +- desiredPrecisionOnMT2. Note that by requesting precision of +- 0.01 GeV on an MT2 value of 100 GeV can resJult in speedups of a factor of ..</span>
<span class="w">    </span><span class="no">const</span><span class="w"> </span><span class="no">bool</span><span class="w"> </span><span class="no">useDeciSectionsInitially</span><span class="o">=</span><span class="no">true</span><span class="w"> </span><span class="c1">// If true, interval is cut at the 10% point until first acceptance, which gives factor 3 increase in speed calculating kinematic min, but 3% slowdown for events in the bulk.  Is on (true) by default, but can be turned off by setting to false.</span>
<span class="w">      </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>


<span class="w">    </span><span class="n">disableCopyrightMessage</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span><span class="w"> </span><span class="c1">// By supplying an argument to disable, we actually ask for the message to be printed, if printing is not already disabled.   This counterintuitive function naming is to avoid the need to introduce static variable initialisations ....</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m1Min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mVis1</span><span class="o">+</span><span class="n">mInvis1</span><span class="p">;</span><span class="w"> </span><span class="c1">// when parent has this mass, ellipse 1 has smallest physical size</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m2Min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mVis2</span><span class="o">+</span><span class="n">mInvis2</span><span class="p">;</span><span class="w"> </span><span class="c1">// when parent has this mass, ellipse 2 has smallest physical size</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m1Min</span><span class="o">&gt;</span><span class="n">m2Min</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// swap 1 and 2</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">asymm_mt2_lester_bisect</span><span class="o">::</span><span class="n">get_mT2_Sq</span><span class="p">(</span><span class="w"></span>
<span class="w">               </span><span class="n">mVis2</span><span class="p">,</span><span class="w"> </span><span class="n">pxVis2</span><span class="p">,</span><span class="w"> </span><span class="n">pyVis2</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="n">mVis1</span><span class="p">,</span><span class="w"> </span><span class="n">pxVis1</span><span class="p">,</span><span class="w"> </span><span class="n">pyVis1</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="n">pxMiss</span><span class="p">,</span><span class="w"> </span><span class="n">pyMiss</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="n">mInvis2</span><span class="p">,</span><span class="w"> </span><span class="n">mInvis1</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="n">desiredPrecisionOnMT2</span><span class="w"></span>
<span class="w">             </span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// By now, we can be sure that m1Min &lt;= m2Min</span>
<span class="w">    </span><span class="n">assert</span><span class="p">(</span><span class="n">m1Min</span><span class="o">&lt;=</span><span class="n">m2Min</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m2Min</span><span class="p">;</span><span class="w"> </span><span class="c1">// when parent has this mass, both ellipses are physical, and at least one has zero size.  Note that the name &quot;min&quot; expresses that it is the minimum potential parent mass we should consider, not that it is the min of m1Min and m2Min.  It is in fact the MAX of them!</span>

<span class="w">    </span><span class="c1">// TODO: What about rounding?  What about idiots who give us mVis values that have been computed from E^2-p^2 terms that are perilously close to zero, or perilously degenerate?</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">msSq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mVis1</span><span class="o">*</span><span class="n">mVis1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">sx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pxVis1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">sy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pyVis1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mpSq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mInvis1</span><span class="o">*</span><span class="n">mInvis1</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mtSq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mVis2</span><span class="o">*</span><span class="n">mVis2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">tx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pxVis2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pyVis2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mqSq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mInvis2</span><span class="o">*</span><span class="n">mInvis2</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">sSq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sx</span><span class="o">*</span><span class="n">sx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sy</span><span class="o">*</span><span class="n">sy</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">tSq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="o">*</span><span class="n">tx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ty</span><span class="o">*</span><span class="n">ty</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">pMissSq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pxMiss</span><span class="o">*</span><span class="n">pxMiss</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pyMiss</span><span class="o">*</span><span class="n">pyMiss</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">massSqSum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msSq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mtSq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mpSq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mqSq</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">scaleSq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">massSqSum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sSq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tSq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pMissSq</span><span class="p">)</span><span class="o">/</span><span class="mf">8.0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// #define LESTER_DBG 1</span>

<span class="cp">#ifdef LESTER_DBG</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">MOO &quot;</span><span class="p">;</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="c1">// Check for an easy MT2 zero, not because we think it will speed up many cases, but because it will allow us to, ever after, assume that scaleSq&gt;0.</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scaleSq</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">scaleSq</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// disjoint at mMin.  So find an mUpper at which they are not disjoint:</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">mLower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mMin</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">mUpper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mMin</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale</span><span class="p">;</span><span class="w"> </span><span class="c1">// since scaleSq is guaranteed to be &gt;0 at this stage, the adition of scaleSq quarantees that mUpperSq is also &gt;0, so it can be exponentially grown (later) by doubling.</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">attempts</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">maxAttempts</span><span class="o">=</span><span class="mi">10000</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="o">++</span><span class="n">attempts</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mUpperSq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mUpper</span><span class="o">*</span><span class="n">mUpper</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">Lester</span><span class="o">::</span><span class="n">EllipseParams</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">side1</span><span class="o">=</span><span class="n">helper</span><span class="p">(</span><span class="n">mUpperSq</span><span class="p">,</span><span class="w"> </span><span class="n">msSq</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">sx</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">sy</span><span class="p">,</span><span class="w"> </span><span class="n">mpSq</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">      </span><span class="mi">0</span><span class="w">     </span><span class="p">);</span><span class="w"> </span><span class="c1">// see side1Coeffs in mathematica notebook</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">Lester</span><span class="o">::</span><span class="n">EllipseParams</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">side2</span><span class="o">=</span><span class="n">helper</span><span class="p">(</span><span class="n">mUpperSq</span><span class="p">,</span><span class="w"> </span><span class="n">mtSq</span><span class="p">,</span><span class="w"> </span><span class="o">+</span><span class="n">tx</span><span class="p">,</span><span class="w"> </span><span class="o">+</span><span class="n">ty</span><span class="p">,</span><span class="w"> </span><span class="n">mqSq</span><span class="p">,</span><span class="w"> </span><span class="n">pxMiss</span><span class="p">,</span><span class="w"> </span><span class="n">pyMiss</span><span class="p">);</span><span class="w"> </span><span class="c1">// see side2Coeffs in mathematica notebook</span>

<span class="w">      </span><span class="kt">bool</span><span class="w"> </span><span class="n">disjoint</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">disjoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Lester</span><span class="o">::</span><span class="n">ellipsesAreDisjoint</span><span class="p">(</span><span class="n">side1</span><span class="p">,</span><span class="w"> </span><span class="n">side2</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(...)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">MT2_ERROR</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">disjoint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attempts</span><span class="o">&gt;=</span><span class="n">maxAttempts</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;MT2 algorithm failed to find upper bound to MT2&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">MT2_ERROR</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="cp">#ifdef LESTER_DBG</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; - &quot;</span><span class="p">;</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">      </span><span class="n">mUpper</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// grow mUpper exponentially</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">//const double tol = relativeTolerance * sqrt(scaleSq);</span>

<span class="w">    </span><span class="c1">// Now begin the bisection:</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">goLow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">useDeciSectionsInitially</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">desiredPrecisionOnMT2</span><span class="o">&lt;=</span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mUpper</span><span class="o">-</span><span class="n">mLower</span><span class="o">&gt;</span><span class="n">desiredPrecisionOnMT2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">trialM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">goLow</span><span class="w"> </span><span class="o">?</span><span class="w"></span>
<span class="w">                              </span><span class="p">(</span><span class="n">mLower</span><span class="o">*</span><span class="mi">15</span><span class="o">+</span><span class="n">mUpper</span><span class="p">)</span><span class="o">/</span><span class="mi">16</span><span class="w">  </span><span class="c1">// bias low until evidence this is not a special case</span>
<span class="w">                              </span><span class="o">:</span><span class="w"></span>
<span class="w">                              </span><span class="p">(</span><span class="n">mUpper</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mLower</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="w"> </span><span class="c1">// bisect</span>
<span class="w">                            </span><span class="p">);</span><span class="w"> </span><span class="c1">// worry about this not being between mUpperSq and mLowerSq! TODO</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">trialM</span><span class="o">&lt;=</span><span class="n">mLower</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">trialM</span><span class="o">&gt;=</span><span class="n">mUpper</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// We reached a numerical precision limit:  the interval can no longer be bisected!</span>
<span class="cp">#ifdef LESTER_DBG</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; MACHINE_PREC &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">setprecision</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">mLower</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">trialM</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">mUpper</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">mUpper</span><span class="o">-</span><span class="n">mLower</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">desiredPrecisionOnMT2</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">trialM</span><span class="o">*</span><span class="n">trialM</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">trialMSq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trialM</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">trialM</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">Lester</span><span class="o">::</span><span class="n">EllipseParams</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">side1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">helper</span><span class="p">(</span><span class="n">trialMSq</span><span class="p">,</span><span class="w"> </span><span class="n">msSq</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">sx</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">sy</span><span class="p">,</span><span class="w"> </span><span class="n">mpSq</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">      </span><span class="mi">0</span><span class="w">     </span><span class="p">);</span><span class="w"> </span><span class="c1">// see side1Coeffs in mathematica notebook</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">Lester</span><span class="o">::</span><span class="n">EllipseParams</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">side2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">helper</span><span class="p">(</span><span class="n">trialMSq</span><span class="p">,</span><span class="w"> </span><span class="n">mtSq</span><span class="p">,</span><span class="w"> </span><span class="o">+</span><span class="n">tx</span><span class="p">,</span><span class="w"> </span><span class="o">+</span><span class="n">ty</span><span class="p">,</span><span class="w"> </span><span class="n">mqSq</span><span class="p">,</span><span class="w"> </span><span class="n">pxMiss</span><span class="p">,</span><span class="w"> </span><span class="n">pyMiss</span><span class="p">);</span><span class="w"> </span><span class="c1">// see side2Coeffs in mathematica notebook</span>

<span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">disjoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Lester</span><span class="o">::</span><span class="n">ellipsesAreDisjoint</span><span class="p">(</span><span class="n">side1</span><span class="p">,</span><span class="w"> </span><span class="n">side2</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">disjoint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">mLower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trialM</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="n">goLow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="cp">#ifdef LESTER_DBG</span>
<span class="w">          </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;UP &quot;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">mUpper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trialM</span><span class="p">;</span><span class="w"></span>
<span class="cp">#ifdef LESTER_DBG</span>
<span class="w">          </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;== &quot;</span><span class="p">;</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(...)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// The test for ellipses being disjoint failed ... this means the ellipses became degenerate, which can only happen right at the bottom of the MT2 search range (subject to numerical precision).  So:</span>
<span class="cp">#ifdef LESTER_DBG</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; THROW &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mLower</span><span class="o">*</span><span class="n">mLower</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mAns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">mLower</span><span class="o">+</span><span class="n">mUpper</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">;</span><span class="w"></span>

<span class="cp">#ifdef LESTER_DBG</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; USER_PREC &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">mAns</span><span class="o">*</span><span class="n">mAns</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">};</span><span class="w"></span>
<span class="w"> </span><span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">lestermax</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="n">y</span><span class="p">)</span><span class="o">?</span><span class="n">x</span><span class="o">:</span><span class="n">y</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Lester</span><span class="o">::</span><span class="n">EllipseParams</span><span class="w"> </span><span class="n">helper</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mSq</span><span class="p">,</span><span class="w"> </span><span class="c1">// The test parent-mass value (squared)</span>
<span class="w">       </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mtSq</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">tx</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">ty</span><span class="p">,</span><span class="w"> </span><span class="c1">// The visible particle transverse momentum</span>
<span class="w">       </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mqSq</span><span class="p">,</span><span class="w"> </span><span class="c1">// The mass of the invisible particle</span>
<span class="w">       </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">pxmiss</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">pymiss</span><span class="w"></span>
<span class="w">             </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">txSq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="o">*</span><span class="n">tx</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">tySq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ty</span><span class="o">*</span><span class="n">ty</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">pxmissSq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pxmiss</span><span class="o">*</span><span class="n">pxmiss</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">pymissSq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pymiss</span><span class="o">*</span><span class="n">pymiss</span><span class="p">;</span><span class="w"></span>


<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">c_xx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">+</span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">mtSq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">tySq</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">c_yy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">+</span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">mtSq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">txSq</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">c_xy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-4.0</span><span class="o">*</span><span class="w"> </span><span class="n">tx</span><span class="o">*</span><span class="n">ty</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">c_x</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">-4.0</span><span class="o">*</span><span class="w"> </span><span class="n">mtSq</span><span class="o">*</span><span class="n">pxmiss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="w"> </span><span class="n">mqSq</span><span class="o">*</span><span class="n">tx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="w"> </span><span class="n">mSq</span><span class="o">*</span><span class="n">tx</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="w"> </span><span class="n">mtSq</span><span class="o">*</span><span class="n">tx</span><span class="w">  </span><span class="o">+</span><span class="w"></span>
<span class="w">               </span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">pymiss</span><span class="o">*</span><span class="n">tx</span><span class="o">*</span><span class="n">ty</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">pxmiss</span><span class="o">*</span><span class="n">tySq</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">c_y</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">-4.0</span><span class="o">*</span><span class="w"> </span><span class="n">mtSq</span><span class="o">*</span><span class="n">pymiss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">pymiss</span><span class="o">*</span><span class="n">txSq</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="w"> </span><span class="n">mqSq</span><span class="o">*</span><span class="n">ty</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="w"> </span><span class="n">mSq</span><span class="o">*</span><span class="n">ty</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2.0</span><span class="o">*</span><span class="w"> </span><span class="n">mtSq</span><span class="o">*</span><span class="n">ty</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">               </span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">pxmiss</span><span class="o">*</span><span class="n">tx</span><span class="o">*</span><span class="n">ty</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">mqSq</span><span class="o">*</span><span class="n">mqSq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">mqSq</span><span class="o">*</span><span class="n">mSq</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mSq</span><span class="o">*</span><span class="n">mSq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">mqSq</span><span class="o">*</span><span class="n">mtSq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">mSq</span><span class="o">*</span><span class="n">mtSq</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mtSq</span><span class="o">*</span><span class="n">mtSq</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">                </span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">mtSq</span><span class="o">*</span><span class="n">pxmissSq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">mtSq</span><span class="o">*</span><span class="n">pymissSq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">mqSq</span><span class="o">*</span><span class="n">pxmiss</span><span class="o">*</span><span class="n">tx</span><span class="w"> </span><span class="o">-</span><span class="w"></span>
<span class="w">                </span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">mSq</span><span class="o">*</span><span class="n">pxmiss</span><span class="o">*</span><span class="n">tx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">mtSq</span><span class="o">*</span><span class="n">pxmiss</span><span class="o">*</span><span class="n">tx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">mqSq</span><span class="o">*</span><span class="n">txSq</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">                </span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">pymissSq</span><span class="o">*</span><span class="n">txSq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">mqSq</span><span class="o">*</span><span class="n">pymiss</span><span class="o">*</span><span class="n">ty</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">mSq</span><span class="o">*</span><span class="n">pymiss</span><span class="o">*</span><span class="n">ty</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">                </span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">mtSq</span><span class="o">*</span><span class="n">pymiss</span><span class="o">*</span><span class="n">ty</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">8.0</span><span class="o">*</span><span class="w"> </span><span class="n">pxmiss</span><span class="o">*</span><span class="n">pymiss</span><span class="o">*</span><span class="n">tx</span><span class="o">*</span><span class="n">ty</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">mqSq</span><span class="o">*</span><span class="n">tySq</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">                </span><span class="mf">4.0</span><span class="o">*</span><span class="w"> </span><span class="n">pxmissSq</span><span class="o">*</span><span class="n">tySq</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Lester</span><span class="o">::</span><span class="n">EllipseParams</span><span class="p">(</span><span class="n">c_xx</span><span class="p">,</span><span class="w"> </span><span class="n">c_yy</span><span class="p">,</span><span class="w"> </span><span class="n">c_xy</span><span class="p">,</span><span class="w"> </span><span class="n">c_x</span><span class="p">,</span><span class="w"> </span><span class="n">c_y</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">myversion</span><span class="p">(){</span><span class="w"></span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Version is : 2014_11_13&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="kt">double</span><span class="w"> </span><span class="nf">MT</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">px1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">px2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">py1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">py2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m2</span><span class="p">){</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">E1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">px1</span><span class="o">*</span><span class="n">px1</span><span class="o">+</span><span class="n">py1</span><span class="o">*</span><span class="n">py1</span><span class="o">+</span><span class="n">m1</span><span class="o">*</span><span class="n">m1</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">E2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">px2</span><span class="o">*</span><span class="n">px2</span><span class="o">+</span><span class="n">py2</span><span class="o">*</span><span class="n">py2</span><span class="o">+</span><span class="n">m2</span><span class="o">*</span><span class="n">m2</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">Msq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">E1</span><span class="o">+</span><span class="n">E2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">E1</span><span class="o">+</span><span class="n">E2</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">px1</span><span class="o">+</span><span class="n">px2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">px1</span><span class="o">+</span><span class="n">px2</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">py1</span><span class="o">+</span><span class="n">py2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">py1</span><span class="o">+</span><span class="n">py2</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Msq</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">Msq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">Msq</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="kt">double</span><span class="o">&gt;</span><span class="w">  </span><span class="n">ben_findsols</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">MT2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">px</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">py</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">visM</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">Ma</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">pxb</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">pyb</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">metx</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">mety</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">visMb</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">Mb</span><span class="p">){</span><span class="w"></span>

<span class="w">  </span><span class="c1">//Visible particle (px,py,visM)</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sols</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="c1">//Find the minimizing points given MT2</span>

<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">Pt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">px</span><span class="o">*</span><span class="n">px</span><span class="o">+</span><span class="n">py</span><span class="o">*</span><span class="n">py</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">Pt</span><span class="o">*</span><span class="n">Pt</span><span class="o">+</span><span class="n">visM</span><span class="o">*</span><span class="n">visM</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT2</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">E2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">E</span><span class="o">*</span><span class="n">E</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">M2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="o">*</span><span class="n">M</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">M4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M2</span><span class="o">*</span><span class="n">M2</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">Ma2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ma</span><span class="o">*</span><span class="n">Ma</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">Ma4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ma2</span><span class="o">*</span><span class="n">Ma2</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">px2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">px</span><span class="o">*</span><span class="n">px</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">py2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">py</span><span class="o">*</span><span class="n">py</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">px4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">px2</span><span class="o">*</span><span class="n">px2</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">py4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">py2</span><span class="o">*</span><span class="n">py2</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">py3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">py2</span><span class="o">*</span><span class="n">py</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">E4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">E2</span><span class="o">*</span><span class="n">E2</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">TermA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">E2</span><span class="o">*</span><span class="n">px</span><span class="o">-</span><span class="n">M2</span><span class="o">*</span><span class="n">px</span><span class="o">+</span><span class="n">Ma2</span><span class="o">*</span><span class="n">px</span><span class="o">-</span><span class="n">px2</span><span class="o">*</span><span class="n">px</span><span class="o">-</span><span class="n">px</span><span class="o">*</span><span class="n">py2</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">TermB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-2.</span><span class="o">*</span><span class="n">px</span><span class="o">*</span><span class="n">py</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">TermSqy0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">E4</span><span class="o">*</span><span class="n">E2</span><span class="mf">-2.</span><span class="o">*</span><span class="n">E4</span><span class="o">*</span><span class="n">M2</span><span class="mf">-2.</span><span class="o">*</span><span class="n">E4</span><span class="o">*</span><span class="n">Ma2</span><span class="mf">-2.</span><span class="o">*</span><span class="n">E4</span><span class="o">*</span><span class="n">px2</span><span class="mf">-2.</span><span class="o">*</span><span class="n">E4</span><span class="o">*</span><span class="n">py2</span><span class="o">+</span><span class="n">E2</span><span class="o">*</span><span class="n">M4</span><span class="mf">-2.</span><span class="o">*</span><span class="n">E2</span><span class="o">*</span><span class="n">M2</span><span class="o">*</span><span class="n">Ma2</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">E2</span><span class="o">*</span><span class="n">M2</span><span class="o">*</span><span class="n">px2</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">E2</span><span class="o">*</span><span class="n">M2</span><span class="o">*</span><span class="n">py2</span><span class="o">+</span><span class="n">E2</span><span class="o">*</span><span class="n">Ma4</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">E2</span><span class="o">*</span><span class="n">Ma2</span><span class="o">*</span><span class="n">px2</span><span class="mf">-2.</span><span class="o">*</span><span class="n">E2</span><span class="o">*</span><span class="n">Ma2</span><span class="o">*</span><span class="n">py2</span><span class="o">+</span><span class="n">E2</span><span class="o">*</span><span class="n">px4</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">E2</span><span class="o">*</span><span class="n">px2</span><span class="o">*</span><span class="n">py2</span><span class="o">+</span><span class="n">E2</span><span class="o">*</span><span class="n">py4</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">TermSqy1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-4.</span><span class="o">*</span><span class="n">E4</span><span class="o">*</span><span class="n">py</span><span class="o">+</span><span class="mf">4.</span><span class="o">*</span><span class="n">E2</span><span class="o">*</span><span class="n">M2</span><span class="o">*</span><span class="n">py</span><span class="mf">-4.</span><span class="o">*</span><span class="n">E2</span><span class="o">*</span><span class="n">Ma2</span><span class="o">*</span><span class="n">py</span><span class="o">+</span><span class="mf">4.</span><span class="o">*</span><span class="n">E2</span><span class="o">*</span><span class="n">px2</span><span class="o">*</span><span class="n">py</span><span class="o">+</span><span class="mf">4.</span><span class="o">*</span><span class="n">E2</span><span class="o">*</span><span class="n">py3</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">TermSqy2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-4.</span><span class="o">*</span><span class="n">E4</span><span class="o">+</span><span class="mf">4.</span><span class="o">*</span><span class="n">E2</span><span class="o">*</span><span class="n">px2</span><span class="o">+</span><span class="mf">4.</span><span class="o">*</span><span class="n">E2</span><span class="o">*</span><span class="n">py2</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="c1">//First, determine the range.</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">myx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">myy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TermSqy1</span><span class="o">*</span><span class="n">TermSqy1</span><span class="mf">-4.</span><span class="o">*</span><span class="n">TermSqy0</span><span class="o">*</span><span class="n">TermSqy2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="c1">//unbalanced</span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">else</span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">sol1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">TermSqy1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">TermSqy1</span><span class="o">*</span><span class="n">TermSqy1</span><span class="mf">-4.</span><span class="o">*</span><span class="n">TermSqy0</span><span class="o">*</span><span class="n">TermSqy2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">TermSqy2</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">sol2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">TermSqy1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">TermSqy1</span><span class="o">*</span><span class="n">TermSqy1</span><span class="mf">-4.</span><span class="o">*</span><span class="n">TermSqy0</span><span class="o">*</span><span class="n">TermSqy2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">TermSqy2</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sol1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sol2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">low</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">high</span><span class="p">){</span><span class="w"></span>
<span class="w">      </span><span class="n">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sol2</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">high</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sol1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">myclose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">99999999.</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">metpy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">low</span><span class="p">;</span><span class="w"> </span><span class="n">metpy</span><span class="o">&lt;=</span><span class="n">high</span><span class="p">;</span><span class="w"> </span><span class="n">metpy</span><span class="o">+=</span><span class="p">(</span><span class="n">high</span><span class="o">-</span><span class="n">low</span><span class="p">)</span><span class="o">/</span><span class="mf">10000.</span><span class="p">){</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">metpx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="n">TermB</span><span class="o">*</span><span class="n">metpy</span><span class="o">+</span><span class="n">TermA</span><span class="o">-</span><span class="n">sqrt</span><span class="p">(</span><span class="n">TermSqy0</span><span class="o">+</span><span class="n">TermSqy1</span><span class="o">*</span><span class="n">metpy</span><span class="o">+</span><span class="n">TermSqy2</span><span class="o">*</span><span class="n">metpy</span><span class="o">*</span><span class="n">metpy</span><span class="p">))</span><span class="o">*</span><span class="mf">0.5</span><span class="o">/</span><span class="p">(</span><span class="n">E2</span><span class="o">-</span><span class="n">px2</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">metpx2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="n">TermB</span><span class="o">*</span><span class="n">metpy</span><span class="o">+</span><span class="n">TermA</span><span class="o">+</span><span class="n">sqrt</span><span class="p">(</span><span class="n">TermSqy0</span><span class="o">+</span><span class="n">TermSqy1</span><span class="o">*</span><span class="n">metpy</span><span class="o">+</span><span class="n">TermSqy2</span><span class="o">*</span><span class="n">metpy</span><span class="o">*</span><span class="n">metpy</span><span class="p">))</span><span class="o">*</span><span class="mf">0.5</span><span class="o">/</span><span class="p">(</span><span class="n">E2</span><span class="o">-</span><span class="n">px2</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">mt1a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">(</span><span class="n">px</span><span class="p">,</span><span class="n">metpx</span><span class="p">,</span><span class="n">py</span><span class="p">,</span><span class="n">metpy</span><span class="p">,</span><span class="n">visM</span><span class="p">,</span><span class="n">Ma</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">mt1b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">(</span><span class="n">px</span><span class="p">,</span><span class="n">metpx2</span><span class="p">,</span><span class="n">py</span><span class="p">,</span><span class="n">metpy</span><span class="p">,</span><span class="n">visM</span><span class="p">,</span><span class="n">Ma</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">metpxb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metx</span><span class="o">-</span><span class="n">metpx</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">metpx2b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metx</span><span class="o">-</span><span class="n">metpx2</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">mt2a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">(</span><span class="n">pxb</span><span class="p">,</span><span class="n">metpxb</span><span class="p">,</span><span class="n">pyb</span><span class="p">,</span><span class="n">mety</span><span class="o">-</span><span class="n">metpy</span><span class="p">,</span><span class="n">visMb</span><span class="p">,</span><span class="n">Mb</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">mt2b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MT</span><span class="p">(</span><span class="n">pxb</span><span class="p">,</span><span class="n">metpx2b</span><span class="p">,</span><span class="n">pyb</span><span class="p">,</span><span class="n">mety</span><span class="o">-</span><span class="n">metpy</span><span class="p">,</span><span class="n">visMb</span><span class="p">,</span><span class="n">Mb</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">mt1a</span><span class="o">-</span><span class="n">mt2a</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">myclose</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="n">myclose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fabs</span><span class="p">(</span><span class="n">mt1a</span><span class="o">-</span><span class="n">mt2a</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">myy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metpy</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">myx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metpx</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">mt1b</span><span class="o">-</span><span class="n">mt2b</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">myclose</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="n">myclose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fabs</span><span class="p">(</span><span class="n">mt1b</span><span class="o">-</span><span class="n">mt2b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">myy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metpy</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">myx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metpx2</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="n">sols</span><span class="p">.</span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myx</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">sols</span><span class="p">.</span><span class="n">second</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myy</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">sols</span><span class="p">;</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="cp">#endif</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  
<style>
  /* Sidebar header (and topbar for mobile) */
  .wy-side-nav-search, .wy-nav-top, .wy-nav-side {
    background: #efefef;
  }

  /* Sidebar text */
  .wy-menu-vertical a {
    color: #000000;
  }
</style>


</body>
</html>