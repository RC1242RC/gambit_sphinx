<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Program Listing for File ColliderBit_InterpolatedYields.cpp &mdash; GAMBIT  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/collapsible-lists/css/tree_view.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  <div class="col-lg-9 col-xl-8 text-center">
    <p class="meta"><a href="/">⇦ Back to GAMBIT homepage</a></p>
  </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div> 

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GAMBIT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Program Listing for File ColliderBit_InterpolatedYields.cpp</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="program-listing-for-file-colliderbit-interpolatedyields-cpp">
<span id="program-listing-file-colliderbit-src-colliderbit-interpolatedyields-cpp"></span><h1>Program Listing for File ColliderBit_InterpolatedYields.cpp<a class="headerlink" href="#program-listing-for-file-colliderbit-interpolatedyields-cpp" title="Permalink to this headline"></a></h1>
<p>↰ <a class="reference internal" href="file_ColliderBit_src_ColliderBit_InterpolatedYields.cpp.html#file-colliderbit-src-colliderbit-interpolatedyields-cpp"><span class="std std-ref">Return to documentation for file</span></a> (<code class="docutils literal notranslate"><span class="pre">ColliderBit/src/ColliderBit_InterpolatedYields.cpp</span></code>)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//   GAMBIT: Global and Modular BSM Inference Tool</span>
<span class="c1">//   *********************************************</span>

<span class="c1">// Needs GSL 2</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gsl/gsl_math.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gsl/gsl_interp2d.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gsl/gsl_spline2d.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gsl/gsl_sf_gamma.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Eigen/Eigenvalues&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Eigen/Eigen&quot;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;multimin/multimin.hpp&quot;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gambit/ColliderBit/analyses/Analysis.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gambit/Elements/gambit_module_headers.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gambit/ColliderBit/ColliderBit_rollcall.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gambit/Utils/interp_collection.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gambit/Utils/file_lock.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gambit/Utils/util_macros.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gambit/ColliderBit/Utils.hpp&quot;</span><span class="cp"></span>


<span class="c1">// #define COLLIDERBIT_DEBUG_PROFILING</span>
<span class="c1">// #define COLLIDERBIT_DEBUG</span>
<span class="c1">// #define DEBUG_PREFIX &quot;DEBUG: OMP thread &quot; &lt;&lt; omp_get_thread_num() &lt;&lt; &quot;:  &quot;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">Gambit</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="k">namespace</span><span class="w"> </span><span class="nn">ColliderBit</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="c1">// =========== Useful stuff ===========</span>

<span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="nc">DMEFT_analysis_info</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">public</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Standard analysis info:</span>

<span class="w">        </span><span class="n">str</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">lumi_invfb</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n_signal_regions</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">obsnum</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bkgnum</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bkgerr</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span><span class="w"> </span><span class="n">bkgcov</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// A map to hold any extra non-standard numbers we might need for a given analysis.</span>
<span class="w">        </span><span class="c1">// For the DMEFT-specific case we&#39;ll use this to store the MET spectrum bin limits</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">extra_info</span><span class="p">;</span><span class="w"> </span><span class="c1">// Any additional analysis-specific numbers</span>

<span class="w">        </span><span class="c1">// Maps containing 1D and 2D interpolators</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">str</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Utils</span><span class="o">::</span><span class="n">interp1d_collection</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">interp1d</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">str</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Utils</span><span class="o">::</span><span class="n">interp2d_collection</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">interp2d</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Helper functions</span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">add_bkgcov</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;&amp;</span><span class="w"> </span><span class="n">bkgcov_in</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">bkgcov_in</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">bkgcov_in</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">n_signal_regions</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">bkgcov_in</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">bkgcov_in</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">n_signal_regions</span><span class="w"> </span><span class="p">);</span><span class="w"></span>

<span class="w">          </span><span class="c1">// Fill our Eigen matrix</span>
<span class="w">          </span><span class="n">bkgcov</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span><span class="p">(</span><span class="n">n_signal_regions</span><span class="p">,</span><span class="w"> </span><span class="n">n_signal_regions</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_signal_regions</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">bkgcov</span><span class="p">.</span><span class="n">row</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="o">::</span><span class="n">Map</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bkgcov_in</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">bkgcov_in</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">size</span><span class="p">());</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">add_interp1d</span><span class="p">(</span><span class="n">str</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">str</span><span class="o">&gt;</span><span class="w"> </span><span class="n">colnames</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">assert</span><span class="w"> </span><span class="p">(</span><span class="n">interp1d</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// Make sure we&#39;re not overwriting an existing entry</span>
<span class="w">          </span><span class="n">interp1d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Utils</span><span class="o">::</span><span class="n">interp1d_collection</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Utils</span><span class="o">::</span><span class="n">interp1d_collection</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">add_interp2d</span><span class="p">(</span><span class="n">str</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">str</span><span class="o">&gt;</span><span class="w"> </span><span class="n">colnames</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">assert</span><span class="w"> </span><span class="p">(</span><span class="n">interp2d</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// Make sure we&#39;re not overwriting an existing entry</span>
<span class="w">          </span><span class="n">interp2d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Utils</span><span class="o">::</span><span class="n">interp2d_collection</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Utils</span><span class="o">::</span><span class="n">interp2d_collection</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">Utils</span><span class="o">::</span><span class="n">interp1d_collection</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">get_interp1d</span><span class="p">(</span><span class="n">str</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="n">interp1d</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">Utils</span><span class="o">::</span><span class="n">interp2d_collection</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">get_interp2d</span><span class="p">(</span><span class="n">str</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="n">interp2d</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>


<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">_gsl_target_func_params</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">lambda</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">AnalysisDataPointers</span><span class="w"> </span><span class="n">adata_ptrs_original</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">str</span><span class="o">&gt;</span><span class="w"> </span><span class="n">skip_analyses</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">bool</span><span class="w"> </span><span class="n">use_covar</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">bool</span><span class="w"> </span><span class="n">use_marg</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">bool</span><span class="w"> </span><span class="n">combine_nocovar_SRs</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>


<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">str</span><span class="p">,</span><span class="n">DMEFT_analysis_info</span><span class="o">&gt;</span><span class="w"> </span><span class="n">analysis_info_map</span><span class="p">;</span><span class="w"></span>


<span class="w">    </span><span class="c1">// =========== Forward declarations ===========</span>

<span class="w">    </span><span class="n">AnalysisLogLikes</span><span class="w"> </span><span class="nf">calc_loglikes_for_analysis</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">AnalysisData</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">fill_analysis_info_map</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DMEFT_results</span><span class="p">(</span><span class="n">AnalysisDataPointers</span><span class="o">&amp;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">get_all_DMEFT_signal_yields</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">DMEFT_analysis_info</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Spectrum</span><span class="o">&amp;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">get_DMEFT_signal_yields_dim6_operator</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">DMEFT_analysis_info</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">get_DMEFT_signal_yields_dim7_operator</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">DMEFT_analysis_info</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DMEFT_results_profiled</span><span class="p">(</span><span class="n">AnalysisDataPointers</span><span class="o">&amp;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DMEFT_results_cutoff</span><span class="p">(</span><span class="n">AnalysisDataPointers</span><span class="o">&amp;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">signal_modifier_function</span><span class="p">(</span><span class="n">AnalysisData</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">signal_cutoff_function</span><span class="p">(</span><span class="n">AnalysisData</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">_gsl_target_func</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">*</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">calc_DMEFT_profiled_LHC_nuisance_params</span><span class="p">(</span><span class="n">map_str_dbl</span><span class="o">&amp;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">InterpolatedMCInfo</span><span class="p">(</span><span class="n">MCLoopInfo</span><span class="o">&amp;</span><span class="p">);</span><span class="w"></span>


<span class="w">    </span><span class="c1">// =========== Functions ===========</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">fill_analysis_info_map</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Helper variables</span>
<span class="w">      </span><span class="n">str</span><span class="w"> </span><span class="n">current_analysis_name</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">str</span><span class="o">&gt;</span><span class="w"> </span><span class="n">colnames</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">DMEFT_analysis_info</span><span class="w"> </span><span class="n">empty_analysis_info</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">DMEFT_analysis_info</span><span class="o">*</span><span class="w"> </span><span class="n">current_ainfo</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="c1">// New analysis: CMS_13TeV_MONOJET_36invfb_interpolated</span>
<span class="w">      </span><span class="c1">//</span>

<span class="w">      </span><span class="c1">// Analysis name</span>
<span class="w">      </span><span class="n">current_analysis_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;CMS_13TeV_MONOJET_36invfb_interpolated&quot;</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Create an entry in the global analysis_info_map and point the pointer current_ainfo to it</span>
<span class="w">      </span><span class="n">analysis_info_map</span><span class="p">[</span><span class="n">current_analysis_name</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DMEFT_analysis_info</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="n">analysis_info_map</span><span class="p">[</span><span class="n">current_analysis_name</span><span class="p">]);</span><span class="w"></span>

<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_analysis_name</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">lumi_invfb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">36.1</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">obsnum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">136865</span><span class="p">,</span><span class="w"> </span><span class="mi">74340</span><span class="p">,</span><span class="w"> </span><span class="mi">42540</span><span class="p">,</span><span class="w"> </span><span class="mi">25316</span><span class="p">,</span><span class="w"> </span><span class="mi">15653</span><span class="p">,</span><span class="w"> </span><span class="mi">10092</span><span class="p">,</span><span class="w"> </span><span class="mi">8298</span><span class="p">,</span><span class="w"> </span><span class="mi">4906</span><span class="p">,</span><span class="w"> </span><span class="mi">2987</span><span class="p">,</span><span class="w"> </span><span class="mi">2032</span><span class="p">,</span><span class="w"> </span><span class="mi">1514</span><span class="p">,</span><span class="w"></span>
<span class="w">                               </span><span class="mi">926</span><span class="p">,</span><span class="w"> </span><span class="mi">557</span><span class="p">,</span><span class="w"> </span><span class="mi">316</span><span class="p">,</span><span class="w"> </span><span class="mi">233</span><span class="p">,</span><span class="w"> </span><span class="mi">172</span><span class="p">,</span><span class="w"> </span><span class="mi">101</span><span class="p">,</span><span class="w"> </span><span class="mi">65</span><span class="p">,</span><span class="w"> </span><span class="mi">46</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="mi">29</span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">bkgnum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">134500.</span><span class="p">,</span><span class="w"> </span><span class="mf">73400.</span><span class="p">,</span><span class="w"> </span><span class="mf">42320.</span><span class="p">,</span><span class="w"> </span><span class="mf">25490.</span><span class="p">,</span><span class="w"> </span><span class="mf">15430.</span><span class="p">,</span><span class="w"> </span><span class="mf">10160.</span><span class="p">,</span><span class="w"> </span><span class="mf">8480.</span><span class="p">,</span><span class="w"> </span><span class="mf">4865.</span><span class="p">,</span><span class="w"> </span><span class="mf">2970.</span><span class="p">,</span><span class="w"> </span><span class="mf">1915.</span><span class="p">,</span><span class="w"> </span><span class="mf">1506.</span><span class="p">,</span><span class="w"></span>
<span class="w">                               </span><span class="mf">844.</span><span class="p">,</span><span class="w"> </span><span class="mf">526.</span><span class="p">,</span><span class="w"> </span><span class="mf">325.</span><span class="p">,</span><span class="w"> </span><span class="mf">223.</span><span class="p">,</span><span class="w"> </span><span class="mf">169.</span><span class="p">,</span><span class="w"> </span><span class="mf">107.</span><span class="p">,</span><span class="w"> </span><span class="mf">88.1</span><span class="p">,</span><span class="w"> </span><span class="mf">52.8</span><span class="p">,</span><span class="w"> </span><span class="mf">25.0</span><span class="p">,</span><span class="w"> </span><span class="mf">25.5</span><span class="p">,</span><span class="w"> </span><span class="mf">26.9</span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">bkgerr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">3700.</span><span class="p">,</span><span class="w"> </span><span class="mf">2000.</span><span class="p">,</span><span class="w"> </span><span class="mf">810.</span><span class="p">,</span><span class="w"> </span><span class="mf">490.</span><span class="p">,</span><span class="w"> </span><span class="mf">310.</span><span class="p">,</span><span class="w"> </span><span class="mf">170.</span><span class="p">,</span><span class="w"> </span><span class="mf">140.</span><span class="p">,</span><span class="w"> </span><span class="mf">95.</span><span class="p">,</span><span class="w"> </span><span class="mf">49.</span><span class="p">,</span><span class="w"> </span><span class="mf">33.</span><span class="p">,</span><span class="w"> </span><span class="mf">32.</span><span class="p">,</span><span class="w"></span>
<span class="w">                               </span><span class="mf">18.</span><span class="p">,</span><span class="w"> </span><span class="mf">14.</span><span class="p">,</span><span class="w"> </span><span class="mf">12.</span><span class="p">,</span><span class="w"> </span><span class="mf">9.</span><span class="p">,</span><span class="w"> </span><span class="mf">8.</span><span class="p">,</span><span class="w"> </span><span class="mf">6.</span><span class="p">,</span><span class="w"> </span><span class="mf">5.3</span><span class="p">,</span><span class="w"> </span><span class="mf">3.9</span><span class="p">,</span><span class="w"> </span><span class="mf">2.5</span><span class="p">,</span><span class="w"> </span><span class="mf">2.6</span><span class="p">,</span><span class="w"> </span><span class="mf">2.8</span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="n">assert</span><span class="p">(</span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">obsnum</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">bkgerr</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"></span>
<span class="w">      </span><span class="n">assert</span><span class="p">(</span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">obsnum</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">bkgerr</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">n_signal_regions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">obsnum</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="c1">// = 22</span>

<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">extra_info</span><span class="p">[</span><span class="s">&quot;metmins&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">250.</span><span class="p">,</span><span class="w"> </span><span class="mf">280.</span><span class="p">,</span><span class="w"> </span><span class="mf">310.</span><span class="p">,</span><span class="w"> </span><span class="mf">340.</span><span class="p">,</span><span class="w"> </span><span class="mf">370.</span><span class="p">,</span><span class="w"> </span><span class="mf">400.</span><span class="p">,</span><span class="w"> </span><span class="mf">430.</span><span class="p">,</span><span class="w"> </span><span class="mf">470.</span><span class="p">,</span><span class="w"> </span><span class="mf">510.</span><span class="p">,</span><span class="w"> </span><span class="mf">550.</span><span class="p">,</span><span class="w"> </span><span class="mf">590.</span><span class="p">,</span><span class="w"></span>
<span class="w">                                              </span><span class="mf">640.</span><span class="p">,</span><span class="w"> </span><span class="mf">690.</span><span class="p">,</span><span class="w"> </span><span class="mf">740.</span><span class="p">,</span><span class="w"> </span><span class="mf">790.</span><span class="p">,</span><span class="w"> </span><span class="mf">840.</span><span class="p">,</span><span class="w"> </span><span class="mf">900.</span><span class="p">,</span><span class="w"> </span><span class="mf">960.</span><span class="p">,</span><span class="w"> </span><span class="mf">1020.</span><span class="p">,</span><span class="w"> </span><span class="mf">1090.</span><span class="p">,</span><span class="w"> </span><span class="mf">1160.</span><span class="p">,</span><span class="w"> </span><span class="mf">1250.</span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="n">assert</span><span class="p">(</span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">obsnum</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">extra_info</span><span class="p">[</span><span class="s">&quot;metmins&quot;</span><span class="p">].</span><span class="n">size</span><span class="p">());</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Construct the background covariance matrix</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">bkgcov</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">1.37e+07</span><span class="p">,</span><span class="w">  </span><span class="mf">7.18e+06</span><span class="p">,</span><span class="w">  </span><span class="mf">2.58e+06</span><span class="p">,</span><span class="w">  </span><span class="mf">1.54e+06</span><span class="p">,</span><span class="w">  </span><span class="mf">9.29e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">4.28e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">3.26e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">2.04e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">8.34e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">5.37e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">4.62e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">2.33e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">1.45e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">1.20e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">6.66e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">7.99e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">4.00e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.57e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">0.00e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">1.30e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">3.85e+02</span><span class="p">,</span><span class="w"> </span><span class="mf">-4.14e+02</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">7.18e+06</span><span class="p">,</span><span class="w">  </span><span class="mf">4.00e+06</span><span class="p">,</span><span class="w">  </span><span class="mf">1.38e+06</span><span class="p">,</span><span class="w">  </span><span class="mf">8.43e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">5.02e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">2.28e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">1.74e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">1.05e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">4.51e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">2.84e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">2.30e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">1.22e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">7.56e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">6.48e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">3.24e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">4.00e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.28e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.06e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.56e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">8.00e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">3.64e+02</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.68e+02</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">2.58e+06</span><span class="p">,</span><span class="w">  </span><span class="mf">1.38e+06</span><span class="p">,</span><span class="w">  </span><span class="mf">6.56e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">3.57e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">2.18e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">1.07e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">8.73e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">5.31e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">2.34e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">1.50e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">1.35e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">7.00e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">4.20e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">3.30e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.26e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.81e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.12e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">6.44e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">2.21e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">3.04e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.47e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">2.27e+01</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">1.54e+06</span><span class="p">,</span><span class="w">  </span><span class="mf">8.43e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">3.57e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">2.40e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">1.32e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">6.58e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">5.14e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">3.17e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">1.44e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">9.22e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">8.15e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">4.06e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.88e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.00e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.32e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.25e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">7.06e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">3.64e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">5.73e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.59e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">7.64e+01</span><span class="p">,</span><span class="w"> </span><span class="mf">-2.74e+01</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">9.29e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">5.02e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">2.18e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">1.32e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">9.61e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">4.11e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">3.21e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">1.88e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">8.81e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">5.73e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">5.46e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.57e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.78e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.34e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">6.98e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">9.18e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">4.28e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.64e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">3.63e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.32e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.05e+02</span><span class="p">,</span><span class="w"> </span><span class="mf">-8.68e+00</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">4.28e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">2.28e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">1.07e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">6.58e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">4.11e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">2.89e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">1.76e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">1.07e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">5.16e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.92e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.83e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.62e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">9.76e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">8.77e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">3.82e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">4.49e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">2.04e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.08e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">9.94e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.02e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">3.98e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">4.76e+00</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">3.26e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">1.74e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">8.73e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">5.14e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">3.21e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">1.76e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">1.96e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">9.18e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">4.39e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.82e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.46e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.39e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">9.21e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">7.39e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">5.17e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">3.70e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">2.35e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">9.65e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">8.19e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">4.20e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.82e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.14e+01</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">2.04e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">1.04e+05</span><span class="p">,</span><span class="w">  </span><span class="mf">5.31e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">3.17e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">1.88e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">1.07e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">9.18e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">9.02e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.61e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.72e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.70e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">8.55e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">4.52e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">4.67e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">2.48e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">2.66e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.54e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">5.04e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.33e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.19e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.21e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">7.98e+00</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">8.34e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">4.51e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">2.34e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">1.44e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">8.81e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">5.16e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">4.39e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.61e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.40e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">9.22e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">8.94e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">4.67e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">2.13e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">2.41e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.41e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.29e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">4.70e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">4.41e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">7.64e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">2.08e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">2.55e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">5.49e+00</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">5.37e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">2.84e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">1.50e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">9.22e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">5.73e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.92e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.82e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.72e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">9.22e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.09e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">5.17e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">3.03e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.62e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.47e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">8.91e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">8.18e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.17e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">2.10e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.29e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">7.42e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">7.72e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">4.62e+00</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">4.62e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">2.30e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">1.35e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">8.15e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">5.46e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.83e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.46e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.70e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">8.94e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">5.17e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.02e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.65e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.57e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.61e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">9.22e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">7.94e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.84e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.39e+00</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.25e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">1.44e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.33e+00</span><span class="p">,</span><span class="w"> </span><span class="mf">-8.96e-01</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">2.33e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">1.22e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">7.00e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">4.06e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.57e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.62e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.39e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">8.55e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">4.67e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">3.03e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">2.65e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">3.24e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">8.57e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">9.07e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">5.83e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.02e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">2.70e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">2.00e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">7.02e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">2.25e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">5.15e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">7.06e+00</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">1.45e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">7.56e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">4.20e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.88e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.78e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">9.76e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">9.21e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">4.52e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">2.13e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.62e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.57e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">8.57e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.96e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">5.21e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.91e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.92e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">2.69e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">8.90e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">6.55e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">0.00e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">1.46e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">1.57e+00</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">1.20e+04</span><span class="p">,</span><span class="w">  </span><span class="mf">6.48e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">3.30e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.00e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.34e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">8.77e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">7.39e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">4.67e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">2.41e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.47e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.61e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">9.07e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">5.21e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.44e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">3.02e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">2.02e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.44e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.18e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">4.68e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">4.50e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">2.18e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">3.02e+00</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">6.66e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">3.24e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.26e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.32e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">6.98e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">3.82e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">5.17e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">2.48e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.41e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">8.91e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">9.22e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">5.83e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.91e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.02e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">8.10e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.15e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.19e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">7.63e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">3.16e+00</span><span class="p">,</span><span class="w"> </span><span class="mf">-2.25e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.40e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">2.52e+00</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">7.99e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">4.00e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.81e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.25e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">9.18e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">4.49e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">3.70e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">2.66e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.29e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">8.18e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">7.94e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.02e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.92e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">2.02e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.15e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">6.40e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.92e+00</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.27e+00</span><span class="p">,</span><span class="w"> </span><span class="mf">-3.12e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.40e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">2.70e+00</span><span class="p">,</span><span class="w"> </span><span class="mf">-6.72e-01</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">4.00e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">2.28e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.12e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">7.06e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">4.28e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">2.04e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">2.35e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.54e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">4.70e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.17e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.84e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">2.70e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">2.69e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.44e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.19e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.92e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">3.60e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">5.09e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">3.74e+00</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.65e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">1.40e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">1.51e+00</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">1.57e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">1.06e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">6.44e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">3.64e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.64e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.08e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">9.65e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">5.04e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">4.41e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">2.10e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.39e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">2.00e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">8.90e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">3.18e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">7.63e+00</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.27e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">5.09e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">2.81e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">6.20e-01</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.19e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">5.51e-01</span><span class="p">,</span><span class="w"> </span><span class="mf">-4.45e-01</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">0.00e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">1.56e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">2.21e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">5.73e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.63e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">9.95e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">8.19e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.33e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">7.64e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">1.29e+00</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.25e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">7.02e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">6.55e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">4.68e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.16e+00</span><span class="p">,</span><span class="w"> </span><span class="mf">-3.12e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.74e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">6.20e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.52e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">7.80e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.04e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.64e+00</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">1.30e+03</span><span class="p">,</span><span class="w">  </span><span class="mf">8.00e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">3.04e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.59e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.32e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.02e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">4.20e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.19e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">2.08e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">7.42e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">1.44e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">2.25e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">0.00e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">4.50e+00</span><span class="p">,</span><span class="w"> </span><span class="mf">-2.25e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.40e+00</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.65e+00</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.19e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">7.80e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">6.25e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">1.30e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">6.30e-01</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w">  </span><span class="mf">3.85e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">3.64e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">1.47e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">7.64e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.05e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">3.98e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.82e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.21e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">2.55e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">7.72e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">3.33e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">5.15e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">1.46e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">2.18e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">1.40e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">2.70e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">1.40e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">5.51e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">3.04e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.30e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">6.76e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">5.82e-01</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="mf">-4.14e+02</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.68e+02</span><span class="p">,</span><span class="w">  </span><span class="mf">2.27e+01</span><span class="p">,</span><span class="w"> </span><span class="mf">-2.74e+01</span><span class="p">,</span><span class="w"> </span><span class="mf">-8.68e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">4.76e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">3.14e+01</span><span class="p">,</span><span class="w">  </span><span class="mf">7.98e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">5.49e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">4.62e+00</span><span class="p">,</span><span class="w"> </span><span class="mf">-8.96e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">7.06e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">1.57e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">3.02e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">2.52e+00</span><span class="p">,</span><span class="w"> </span><span class="mf">-6.72e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.51e+00</span><span class="p">,</span><span class="w"> </span><span class="mf">-4.45e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">1.64e+00</span><span class="p">,</span><span class="w">  </span><span class="mf">6.30e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">5.82e-01</span><span class="p">,</span><span class="w">  </span><span class="mf">7.84e+00</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Save it</span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_bkgcov</span><span class="p">(</span><span class="n">bkgcov</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Create interpolated functions for the CMS analysis:</span>

<span class="w">      </span><span class="c1">// - 2d cross-sections</span>
<span class="w">      </span><span class="n">colnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;mass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;theta&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xsec&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp2d</span><span class="p">(</span><span class="s">&quot;mass_theta_xsecpb_C61_C64&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_theta_xsecpb_CMS_C61_C64.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp2d</span><span class="p">(</span><span class="s">&quot;mass_theta_xsecpb_C62_C63&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_theta_xsecpb_CMS_C62_C63.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// - 1d cross-sections</span>
<span class="w">      </span><span class="n">colnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;mass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xsec&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp1d</span><span class="p">(</span><span class="s">&quot;mass_xsecpb_C71&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_xsecpb_CMS_C71.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp1d</span><span class="p">(</span><span class="s">&quot;mass_xsecpb_C72&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_xsecpb_CMS_C72.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp1d</span><span class="p">(</span><span class="s">&quot;mass_xsecpb_C73&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_xsecpb_CMS_C73.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp1d</span><span class="p">(</span><span class="s">&quot;mass_xsecpb_C74&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_xsecpb_CMS_C74.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// - 2d signal efficiencies</span>
<span class="w">      </span><span class="n">colnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;mass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;theta&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR4&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR5&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR6&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR7&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR8&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR9&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR10&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                  </span><span class="s">&quot;SR11&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR12&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR13&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR14&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR15&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR16&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR17&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR18&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR19&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR20&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR21&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR22&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp2d</span><span class="p">(</span><span class="s">&quot;mass_theta_eff_C61_C64&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_theta_eff_CMS_C61_C64.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp2d</span><span class="p">(</span><span class="s">&quot;mass_theta_eff_C62_C63&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_theta_eff_CMS_C62_C63.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// - 1d signal efficiencies</span>
<span class="w">      </span><span class="n">colnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;mass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR4&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR5&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR6&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR7&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR8&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR9&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR10&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                  </span><span class="s">&quot;SR11&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR12&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR13&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR14&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR15&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR16&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR17&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR18&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR19&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR20&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR21&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR22&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp1d</span><span class="p">(</span><span class="s">&quot;mass_eff_C71&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_eff_CMS_C71.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp1d</span><span class="p">(</span><span class="s">&quot;mass_eff_C72&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_eff_CMS_C72.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp1d</span><span class="p">(</span><span class="s">&quot;mass_eff_C73&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_eff_CMS_C73.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp1d</span><span class="p">(</span><span class="s">&quot;mass_eff_C74&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_eff_CMS_C74.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// &#39;Clear&#39; the pointer current_ainfo before moving on to the next analysis by pointing it to empty_analysis_info</span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">empty_analysis_info</span><span class="p">;</span><span class="w"></span>


<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="c1">// New analysis: ATLAS_13TeV_MONOJET_139invfb_interpolated</span>
<span class="w">      </span><span class="c1">//</span>

<span class="w">      </span><span class="c1">// Analysis name</span>
<span class="w">      </span><span class="n">current_analysis_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ATLAS_13TeV_MONOJET_139invfb_interpolated&quot;</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Create an entry in the global analysis_info_map and point the reference current_ainfo to it</span>
<span class="w">      </span><span class="n">analysis_info_map</span><span class="p">[</span><span class="n">current_analysis_name</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DMEFT_analysis_info</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="n">analysis_info_map</span><span class="p">[</span><span class="n">current_analysis_name</span><span class="p">]);</span><span class="w"></span>

<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_analysis_name</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">lumi_invfb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">139.0</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">obsnum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1791624</span><span class="p">,</span><span class="w"> </span><span class="mi">752328</span><span class="p">,</span><span class="w"> </span><span class="mi">313912</span><span class="p">,</span><span class="w"> </span><span class="mi">141036</span><span class="p">,</span><span class="w"> </span><span class="mi">102888</span><span class="p">,</span><span class="w"> </span><span class="mi">29458</span><span class="p">,</span><span class="w"> </span><span class="mi">10203</span><span class="p">,</span><span class="w"> </span><span class="mi">3986</span><span class="p">,</span><span class="w"> </span><span class="mi">1663</span><span class="p">,</span><span class="w"> </span><span class="mi">738</span><span class="p">,</span><span class="w"> </span><span class="mi">413</span><span class="o">+</span><span class="mi">187</span><span class="o">+</span><span class="mi">207</span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">bkgnum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">1783000.</span><span class="p">,</span><span class="w"> </span><span class="mf">753000.</span><span class="p">,</span><span class="w"> </span><span class="mf">314000.</span><span class="p">,</span><span class="w"> </span><span class="mf">140100.</span><span class="p">,</span><span class="w"> </span><span class="mf">101600.</span><span class="p">,</span><span class="w"> </span><span class="mf">29200.</span><span class="p">,</span><span class="w"> </span><span class="mf">10000.</span><span class="p">,</span><span class="w"> </span><span class="mf">3870.</span><span class="p">,</span><span class="w"> </span><span class="mf">1640.</span><span class="p">,</span><span class="w"> </span><span class="mf">754.</span><span class="p">,</span><span class="w"> </span><span class="mf">359.</span><span class="o">+</span><span class="mf">182.</span><span class="o">+</span><span class="mf">218.</span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">bkgerr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">26000.</span><span class="p">,</span><span class="w"> </span><span class="mf">9000.</span><span class="p">,</span><span class="w"> </span><span class="mf">3500.</span><span class="p">,</span><span class="w"> </span><span class="mf">1600.</span><span class="p">,</span><span class="w"> </span><span class="mf">1200.</span><span class="p">,</span><span class="w"> </span><span class="mf">400.</span><span class="p">,</span><span class="w"> </span><span class="mf">180.</span><span class="p">,</span><span class="w"> </span><span class="mf">80.</span><span class="p">,</span><span class="w"> </span><span class="mf">40.</span><span class="p">,</span><span class="w"> </span><span class="mf">20.</span><span class="p">,</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="mi">6</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">9</span><span class="o">*</span><span class="mi">9</span><span class="p">)};</span><span class="w"></span>
<span class="w">      </span><span class="n">assert</span><span class="p">(</span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">obsnum</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">bkgnum</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"></span>
<span class="w">      </span><span class="n">assert</span><span class="p">(</span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">obsnum</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">bkgerr</span><span class="p">.</span><span class="n">size</span><span class="p">());</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">n_signal_regions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">obsnum</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"></span>

<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">extra_info</span><span class="p">[</span><span class="s">&quot;metmins&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">200.</span><span class="p">,</span><span class="w"> </span><span class="mf">250.</span><span class="p">,</span><span class="w"> </span><span class="mf">300.</span><span class="p">,</span><span class="w"> </span><span class="mf">350.</span><span class="p">,</span><span class="w"> </span><span class="mf">400.</span><span class="p">,</span><span class="w"> </span><span class="mf">500.</span><span class="p">,</span><span class="w"> </span><span class="mf">600.</span><span class="p">,</span><span class="w"> </span><span class="mf">700.</span><span class="p">,</span><span class="w"> </span><span class="mf">800.</span><span class="p">,</span><span class="w"> </span><span class="mf">900.</span><span class="p">,</span><span class="w"> </span><span class="mf">1000.</span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="n">assert</span><span class="p">(</span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">obsnum</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">extra_info</span><span class="p">[</span><span class="s">&quot;metmins&quot;</span><span class="p">].</span><span class="n">size</span><span class="p">());</span><span class="w"></span>


<span class="w">      </span><span class="c1">// Create interpolated functions for the ATLAS analysis:</span>

<span class="w">      </span><span class="c1">// - 2d cross-sections</span>
<span class="w">      </span><span class="n">colnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;mass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;theta&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xsec&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp2d</span><span class="p">(</span><span class="s">&quot;mass_theta_xsecpb_C61_C64&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_theta_xsecpb_ATLAS_C61_C64.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp2d</span><span class="p">(</span><span class="s">&quot;mass_theta_xsecpb_C62_C63&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_theta_xsecpb_ATLAS_C62_C63.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// - 1d cross-sections</span>
<span class="w">      </span><span class="n">colnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;mass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xsec&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp1d</span><span class="p">(</span><span class="s">&quot;mass_xsecpb_C71&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_xsecpb_ATLAS_C71.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp1d</span><span class="p">(</span><span class="s">&quot;mass_xsecpb_C72&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_xsecpb_ATLAS_C72.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp1d</span><span class="p">(</span><span class="s">&quot;mass_xsecpb_C73&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_xsecpb_ATLAS_C73.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp1d</span><span class="p">(</span><span class="s">&quot;mass_xsecpb_C74&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_xsecpb_ATLAS_C74.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// - 2d signal efficiencies</span>
<span class="w">      </span><span class="n">colnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;mass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;theta&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR4&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR5&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR6&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR7&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR8&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR9&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR10&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR11&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp2d</span><span class="p">(</span><span class="s">&quot;mass_theta_eff_C61_C64&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_theta_eff_ATLAS_C61_C64.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp2d</span><span class="p">(</span><span class="s">&quot;mass_theta_eff_C62_C63&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_theta_eff_ATLAS_C62_C63.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// - 1d signal efficiencies</span>
<span class="w">      </span><span class="n">colnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;mass&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR4&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR5&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR6&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR7&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR8&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR9&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR10&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SR11&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp1d</span><span class="p">(</span><span class="s">&quot;mass_eff_C71&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_eff_ATLAS_C71.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp1d</span><span class="p">(</span><span class="s">&quot;mass_eff_C72&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_eff_ATLAS_C72.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp1d</span><span class="p">(</span><span class="s">&quot;mass_eff_C73&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_eff_ATLAS_C73.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="o">-&gt;</span><span class="n">add_interp1d</span><span class="p">(</span><span class="s">&quot;mass_eff_C74&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">GAMBIT_DIR</span><span class="w"> </span><span class="s">&quot;/ColliderBit/data/DMEFT/mass_eff_ATLAS_C74.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// &#39;Clear&#39; the pointer current_ainfo before moving on to the next analysis by pointing it to empty_analysis_info</span>
<span class="w">      </span><span class="n">current_ainfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">empty_analysis_info</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>


<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DMEFT_results</span><span class="p">(</span><span class="n">AnalysisDataPointers</span><span class="o">&amp;</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Pipes</span><span class="o">::</span><span class="nn">DMEFT_results</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// In this function we need to transfer info from the DMEFT-specific DMEFT_analysis_info objects</span>
<span class="w">      </span><span class="c1">// to a set of ColliderBit-native AnalysisData objects, and also fill these with the DMEFT signal prediction.</span>

<span class="w">      </span><span class="c1">// We need thread_local AnalysisData instances. Let&#39;s collect them in a map.</span>
<span class="w">      </span><span class="k">thread_local</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">str</span><span class="p">,</span><span class="n">AnalysisData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">analysis_data_map</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// The first time this function is run we must initialize the global analysis_info_map</span>
<span class="w">      </span><span class="c1">// and the thread_local analysis_data_map</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">first</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">fill_analysis_info_map</span><span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">str</span><span class="p">,</span><span class="k">const</span><span class="w"> </span><span class="n">DMEFT_analysis_info</span><span class="o">&amp;&gt;</span><span class="w"> </span><span class="n">aname_ainfo_pair</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">analysis_info_map</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="c1">// Extract analysis name and use it to create an AnalysisData element in the analysis_data_map</span>
<span class="w">          </span><span class="n">str</span><span class="w"> </span><span class="n">aname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aname_ainfo_pair</span><span class="p">.</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="n">analysis_data_map</span><span class="p">[</span><span class="n">aname</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AnalysisData</span><span class="p">(</span><span class="n">aname</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Clear previous vectors, etc.</span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Get the theory spectrum to pass on masses and parameters</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">Spectrum</span><span class="o">&amp;</span><span class="w"> </span><span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">Dep</span><span class="o">::</span><span class="n">DMEFT_spectrum</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="c1">// Loop over the analyses registered in the analysis_info_map</span>
<span class="w">      </span><span class="c1">//</span>

<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">str</span><span class="p">,</span><span class="k">const</span><span class="w"> </span><span class="n">DMEFT_analysis_info</span><span class="o">&amp;&gt;</span><span class="w"> </span><span class="n">aname_ainfo_pair</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">analysis_info_map</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Extract analysis name and reference to the analysis_info instance</span>
<span class="w">        </span><span class="n">str</span><span class="w"> </span><span class="n">aname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aname_ainfo_pair</span><span class="p">.</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">DMEFT_analysis_info</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ainfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aname_ainfo_pair</span><span class="p">.</span><span class="n">second</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Grab a reference to corresponding AnalysisData instance</span>
<span class="w">        </span><span class="c1">// and clear it before we start filling it for the current parameter point</span>
<span class="w">        </span><span class="n">AnalysisData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">adata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analysis_data_map</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">aname</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">adata</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Vector to contain signal yield predictions</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sr_nums</span><span class="p">(</span><span class="n">ainfo</span><span class="p">.</span><span class="n">n_signal_regions</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Fill the signal yield vector with DMEFT signal predictions</span>
<span class="w">        </span><span class="n">get_all_DMEFT_signal_yields</span><span class="p">(</span><span class="n">sr_nums</span><span class="p">,</span><span class="w"> </span><span class="n">ainfo</span><span class="p">,</span><span class="w"> </span><span class="n">spec</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Create vector of SignalRegionData instances</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">SignalRegionData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">srdata_vector</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">sr_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">sr_index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ainfo</span><span class="p">.</span><span class="n">n_signal_regions</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">sr_index</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="c1">// Generate an &#39;sr-N&#39; label</span>
<span class="w">          </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="n">ss</span><span class="p">;</span><span class="w"> </span><span class="n">ss</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;sr-&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">sr_index</span><span class="p">;</span><span class="w"></span>

<span class="w">          </span><span class="c1">// Construct a SignalRegionData instance and add it to srdata_vector</span>
<span class="w">          </span><span class="n">SignalRegionData</span><span class="w"> </span><span class="n">sr</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="n">sr</span><span class="p">.</span><span class="n">sr_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">();</span><span class="w"></span>
<span class="w">          </span><span class="n">sr</span><span class="p">.</span><span class="n">n_obs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ainfo</span><span class="p">.</span><span class="n">obsnum</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">sr_index</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="n">sr</span><span class="p">.</span><span class="n">n_sig_MC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sr_nums</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">sr_index</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="n">sr</span><span class="p">.</span><span class="n">n_sig_scaled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sr_nums</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">sr_index</span><span class="p">);</span><span class="w">  </span><span class="c1">// We have already scaled the signals in sr_nums to xsec * lumi</span>
<span class="w">          </span><span class="n">sr</span><span class="p">.</span><span class="n">n_sig_MC_sys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="n">sr</span><span class="p">.</span><span class="n">n_bkg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ainfo</span><span class="p">.</span><span class="n">bkgnum</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">sr_index</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="n">sr</span><span class="p">.</span><span class="n">n_bkg_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ainfo</span><span class="p">.</span><span class="n">bkgerr</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">sr_index</span><span class="p">);</span><span class="w"></span>

<span class="w">          </span><span class="n">srdata_vector</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">sr</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Save our vector of SignalRegionData in the AnalysisData instance</span>
<span class="w">        </span><span class="n">adata</span><span class="p">.</span><span class="n">srdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">srdata_vector</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// If this analysis has a background covariance matrix, copy it to the AnalysisData instance</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ainfo</span><span class="p">.</span><span class="n">bkgcov</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">adata</span><span class="p">.</span><span class="n">srcov</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ainfo</span><span class="p">.</span><span class="n">bkgcov</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Save a pointer to our AnalysisData instance in the &#39;result&#39; variable</span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adata</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="c1">// End loop over analyses</span>

<span class="w">    </span><span class="p">};</span><span class="w"></span>


<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">get_all_DMEFT_signal_yields</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">sr_nums</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">DMEFT_analysis_info</span><span class="o">&amp;</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Spectrum</span><span class="o">&amp;</span><span class="w"> </span><span class="n">spec</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Get the parameters we need from the theory spectrum</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">C61</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">dimensionless</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C61&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">C62</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">dimensionless</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C62&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">C63</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">dimensionless</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C63&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">C64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">dimensionless</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C64&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">C71</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">dimensionless</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C71&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">C72</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">dimensionless</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C72&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">C73</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">dimensionless</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C73&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">C74</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">dimensionless</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C74&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">mass1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Lambda&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">Pole_Mass</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;chi&quot;</span><span class="p">);</span><span class="w"></span>


<span class="w">      </span><span class="c1">// Get the dim-6 yields</span>

<span class="w">      </span><span class="c1">// C61+C64</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sig_C61_C64</span><span class="p">(</span><span class="n">analysis_info</span><span class="p">.</span><span class="n">n_signal_regions</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">get_DMEFT_signal_yields_dim6_operator</span><span class="p">(</span><span class="n">sig_C61_C64</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C61_C64&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">C61</span><span class="p">,</span><span class="w"> </span><span class="n">C64</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// C62+C63</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sig_C62_C63</span><span class="p">(</span><span class="n">analysis_info</span><span class="p">.</span><span class="n">n_signal_regions</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">get_DMEFT_signal_yields_dim6_operator</span><span class="p">(</span><span class="n">sig_C62_C63</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C62_C63&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">C62</span><span class="p">,</span><span class="w"> </span><span class="n">C63</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="p">);</span><span class="w"></span>


<span class="w">      </span><span class="c1">// Get the dim-7 yields</span>

<span class="w">      </span><span class="c1">// C71</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sig_C71</span><span class="p">(</span><span class="n">analysis_info</span><span class="p">.</span><span class="n">n_signal_regions</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">get_DMEFT_signal_yields_dim7_operator</span><span class="p">(</span><span class="n">sig_C71</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C71&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">C71</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// C72</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sig_C72</span><span class="p">(</span><span class="n">analysis_info</span><span class="p">.</span><span class="n">n_signal_regions</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">get_DMEFT_signal_yields_dim7_operator</span><span class="p">(</span><span class="n">sig_C72</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C72&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">C72</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// C73</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sig_C73</span><span class="p">(</span><span class="n">analysis_info</span><span class="p">.</span><span class="n">n_signal_regions</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">get_DMEFT_signal_yields_dim7_operator</span><span class="p">(</span><span class="n">sig_C73</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C73&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">C73</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// C74</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sig_C74</span><span class="p">(</span><span class="n">analysis_info</span><span class="p">.</span><span class="n">n_signal_regions</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">get_DMEFT_signal_yields_dim7_operator</span><span class="p">(</span><span class="n">sig_C74</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C74&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">C74</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="p">);</span><span class="w"></span>


<span class="w">      </span><span class="c1">// Add yields and save in sr_num</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">.</span><span class="n">n_signal_regions</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">sr_nums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sig_C61_C64</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sig_C62_C63</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sig_C71</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sig_C72</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sig_C73</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sig_C74</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>


<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">get_DMEFT_signal_yields_dim6_operator</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">signal_yields</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="n">operator_key</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">DMEFT_analysis_info</span><span class="o">&amp;</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">O1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">O2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">lambda</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Calculate theta</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">theta</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">O2</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pi</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atan</span><span class="p">(</span><span class="n">O1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">O2</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">O1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">O2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pi</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Calculate normalisation</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">norm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">O1</span><span class="o">*</span><span class="n">O1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">O2</span><span class="o">*</span><span class="n">O2</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">norm</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">ColliderBit_error</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ERROR! norm &lt; 0 in function get_DMEFT_signal_yields_dim6_operator.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Scaling with lambda, relative to lambda = 1000 GeV which was used to generate the data tables</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">lambda_scaling</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="mf">1000.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">lambda</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Get the interpolator collections for the given operator_key</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">Utils</span><span class="o">::</span><span class="n">interp2d_collection</span><span class="o">&amp;</span><span class="w"> </span><span class="n">xsec_interp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">.</span><span class="n">get_interp2d</span><span class="p">(</span><span class="s">&quot;mass_theta_xsecpb_&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">operator_key</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">Utils</span><span class="o">::</span><span class="n">interp2d_collection</span><span class="o">&amp;</span><span class="w"> </span><span class="n">eff_interp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">.</span><span class="n">get_interp2d</span><span class="p">(</span><span class="s">&quot;mass_theta_eff_&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">operator_key</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Compute the signal yield for each signal region</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">sr_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">sr_i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">.</span><span class="n">n_signal_regions</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">sr_i</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="c1">//</span>
<span class="w">        </span><span class="c1">// Get the cross-section at the point (m,theta)</span>
<span class="w">        </span><span class="c1">//</span>

<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">xsec_pb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Check if (m,theta) point is inside interpolation region</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">not</span><span class="w"> </span><span class="n">xsec_interp</span><span class="p">.</span><span class="n">is_inside_range</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">theta</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">theta</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">xsec_interp</span><span class="p">.</span><span class="n">y_min</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">theta</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">xsec_interp</span><span class="p">.</span><span class="n">y_max</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">ColliderBit_error</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ERROR! Theta parameter out of range.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>

<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">xsec_interp</span><span class="p">.</span><span class="n">x_min</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">ColliderBit_error</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mass parameter below lowest mass point in the cross-section table.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>

<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">xsec_interp</span><span class="p">.</span><span class="n">x_min</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Set cross-section to 0 for masses above the tabulated range</span>
<span class="w">            </span><span class="n">xsec_pb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="c1">// All is OK, let&#39;s evaluate the cross-section</span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">xsec_pb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsec_interp</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">theta</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>


<span class="w">        </span><span class="c1">//</span>
<span class="w">        </span><span class="c1">// Get signal efficiency for signal region sr_i at the point (m,theta)</span>
<span class="w">        </span><span class="c1">//</span>

<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">eff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Check if (m,theta) point is inside interpolation region</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">not</span><span class="w"> </span><span class="n">eff_interp</span><span class="p">.</span><span class="n">is_inside_range</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">theta</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">theta</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">eff_interp</span><span class="p">.</span><span class="n">y_min</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">theta</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">eff_interp</span><span class="p">.</span><span class="n">y_max</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">ColliderBit_error</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ERROR! Theta parameter out of range.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>

<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">eff_interp</span><span class="p">.</span><span class="n">x_min</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">ColliderBit_error</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mass parameter below lowest mass point in the signal efficiency table.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>

<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">eff_interp</span><span class="p">.</span><span class="n">x_min</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Set efficiency to 0 for masses above the tabulated range</span>
<span class="w">            </span><span class="n">eff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="c1">// All is OK, let&#39;s evaluate the efficiency</span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">eff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eff_interp</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">theta</span><span class="p">,</span><span class="w"> </span><span class="n">sr_i</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">//</span>
<span class="w">        </span><span class="c1">// Compute signal prediction and save it in the signal_yields vector</span>
<span class="w">        </span><span class="c1">//</span>

<span class="w">        </span><span class="n">signal_yields</span><span class="p">[</span><span class="n">sr_i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">.</span><span class="n">lumi_invfb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">xsec_pb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000.</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">norm</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">lambda_scaling</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">eff</span><span class="p">;</span><span class="w"> </span><span class="c1">// converting cross-section from pb to fb</span>

<span class="w">        </span><span class="cp">#ifdef COLLIDERBIT_DEBUG</span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">scientific</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;DEBUG:&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; operator:&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">operator_key</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, analysis:&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">.</span><span class="n">name</span><span class="w"></span>
<span class="w">               </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, sr_i:&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">sr_i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, m:&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, theta:&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">theta</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, xsec_pb:&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">xsec_pb</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, eff:&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">eff</span><span class="w"></span>
<span class="w">               </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, lambda_scaling:&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">lambda_scaling</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, norm:&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">norm</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, signal:&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">signal_yields</span><span class="p">[</span><span class="n">sr_i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="cp">#endif</span>

<span class="w">      </span><span class="p">}</span><span class="w">  </span><span class="c1">// End loop over signal regions</span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>


<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">get_DMEFT_signal_yields_dim7_operator</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">signal_yields</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="n">operator_key</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">DMEFT_analysis_info</span><span class="o">&amp;</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">O</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">lambda</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Calculate normalisation</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">norm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">O</span><span class="o">*</span><span class="n">O</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">norm</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">ColliderBit_error</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ERROR! norm &lt; 0 in function get_DMEFT_signal_yields_dim7_operator.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Scaling with lambda, relative to lambda = 1000 GeV which was used to generate the data tables</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">lambda_scaling</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="mf">1000.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">lambda</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Get the interpolator collections for the given operator_key</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">Utils</span><span class="o">::</span><span class="n">interp1d_collection</span><span class="o">&amp;</span><span class="w"> </span><span class="n">xsec_interp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">.</span><span class="n">get_interp1d</span><span class="p">(</span><span class="s">&quot;mass_xsecpb_&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">operator_key</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">Utils</span><span class="o">::</span><span class="n">interp1d_collection</span><span class="o">&amp;</span><span class="w"> </span><span class="n">eff_interp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">.</span><span class="n">get_interp1d</span><span class="p">(</span><span class="s">&quot;mass_eff_&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">operator_key</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Compute the signal yield for each signal region</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">sr_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">sr_i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">.</span><span class="n">n_signal_regions</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">sr_i</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="c1">//</span>
<span class="w">        </span><span class="c1">// Get the cross-section for mass m</span>
<span class="w">        </span><span class="c1">//</span>

<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">xsec_pb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Check if m is inside interpolation region</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">not</span><span class="w"> </span><span class="n">xsec_interp</span><span class="p">.</span><span class="n">is_inside_range</span><span class="p">(</span><span class="n">m</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">xsec_interp</span><span class="p">.</span><span class="n">x_min</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">ColliderBit_error</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mass parameter below lowest mass point in the cross-section table.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>

<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">xsec_interp</span><span class="p">.</span><span class="n">x_min</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Set cross-section to 0 for masses above the tabulated range</span>
<span class="w">            </span><span class="n">xsec_pb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="c1">// All is OK, let&#39;s evaluate the cross-section</span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">xsec_pb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsec_interp</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">m</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>


<span class="w">        </span><span class="c1">//</span>
<span class="w">        </span><span class="c1">// Get signal efficiency for signal region sr_i and mass m</span>
<span class="w">        </span><span class="c1">//</span>

<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">eff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Check if m point is inside interpolation region</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">not</span><span class="w"> </span><span class="n">eff_interp</span><span class="p">.</span><span class="n">is_inside_range</span><span class="p">(</span><span class="n">m</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">eff_interp</span><span class="p">.</span><span class="n">x_min</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">ColliderBit_error</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mass parameter below lowest mass point in the signal efficiency table.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>

<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">eff_interp</span><span class="p">.</span><span class="n">x_min</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Set efficiency to 0 for masses above the tabulated range</span>
<span class="w">            </span><span class="n">eff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="c1">// All is OK, let&#39;s evaluate the efficiency</span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">eff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eff_interp</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">sr_i</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">//</span>
<span class="w">        </span><span class="c1">// Compute signal prediction and save it in the signal_yields vector</span>
<span class="w">        </span><span class="c1">//</span>

<span class="w">        </span><span class="n">signal_yields</span><span class="p">[</span><span class="n">sr_i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analysis_info</span><span class="p">.</span><span class="n">lumi_invfb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">xsec_pb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000.</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">norm</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">lambda_scaling</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">eff</span><span class="p">;</span><span class="w"> </span><span class="c1">// converting cross-section from pb to fb</span>

<span class="w">      </span><span class="p">}</span><span class="w">  </span><span class="c1">// End loop over signal regions</span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>


<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">DMEFT_results_profiled</span><span class="p">(</span><span class="n">AnalysisDataPointers</span><span class="o">&amp;</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Pipes</span><span class="o">::</span><span class="nn">DMEFT_results_profiled</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Clear previous vectors, etc.</span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Get the original AnalysisDataPointers that we will adjust</span>
<span class="w">      </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">Dep</span><span class="o">::</span><span class="n">AllAnalysisNumbersUnmodified</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Get the best-fit nuisance parameter(s)</span>
<span class="w">      </span><span class="n">map_str_dbl</span><span class="w"> </span><span class="n">bestfit_nuisance_pars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">Dep</span><span class="o">::</span><span class="n">DMEFT_profiled_LHC_nuisance_params</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">a_bestfit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bestfit_nuisance_pars</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Get Lambda</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">Spectrum</span><span class="o">&amp;</span><span class="w"> </span><span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">Dep</span><span class="o">::</span><span class="n">DMEFT_spectrum</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">mass1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Lambda&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Recalculate AnalysisData instances in &quot;result&quot;, using the best-fit a-value</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">AnalysisData</span><span class="o">*</span><span class="w"> </span><span class="n">adata_ptr</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">signal_modifier_function</span><span class="p">(</span><span class="o">*</span><span class="n">adata_ptr</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="p">,</span><span class="w"> </span><span class="n">a_bestfit</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>


<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">DMEFT_results_cutoff</span><span class="p">(</span><span class="n">AnalysisDataPointers</span><span class="o">&amp;</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Pipes</span><span class="o">::</span><span class="nn">DMEFT_results_cutoff</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Clear previous vectors, etc.</span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Get the original AnalysisDataPointers that we will adjust</span>
<span class="w">      </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">Dep</span><span class="o">::</span><span class="n">AllAnalysisNumbersUnmodified</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Get Lambda</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">Spectrum</span><span class="o">&amp;</span><span class="w"> </span><span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">Dep</span><span class="o">::</span><span class="n">DMEFT_spectrum</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spec</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">mass1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Lambda&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Apply the function signal_cutoff_function to each of the</span>
<span class="w">      </span><span class="c1">// AnalysisData instances in &quot;result&quot;</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">AnalysisData</span><span class="o">*</span><span class="w"> </span><span class="n">adata_ptr</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">signal_cutoff_function</span><span class="p">(</span><span class="o">*</span><span class="n">adata_ptr</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>


<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">signal_modifier_function</span><span class="p">(</span><span class="n">AnalysisData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">adata</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">lambda</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Check that we have analysis info for the given analysis</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">analysis_info_map</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">adata</span><span class="p">.</span><span class="n">analysis_name</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">ColliderBit_error</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Unknown analysis &#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">adata</span><span class="p">.</span><span class="n">analysis_name</span><span class="w"> </span><span class="o">+</span><span class="s">&quot;&#39; encountered in signal_modifier_function!&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Get a shorthand reference to the DMEFT_analysis_info instance</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">DMEFT_analysis_info</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ainfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analysis_info_map</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">adata</span><span class="p">.</span><span class="n">analysis_name</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Modify signals</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">bin_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">bin_index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ainfo</span><span class="p">.</span><span class="n">n_signal_regions</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">bin_index</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">MET_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ainfo</span><span class="p">.</span><span class="n">extra_info</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="s">&quot;metmins&quot;</span><span class="p">)[</span><span class="n">bin_index</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">MET_min</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">MET_min</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">lambda</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">a</span><span class="p">);</span><span class="w"></span>

<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">weight</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1.0e-8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="n">SignalRegionData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">srdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adata</span><span class="p">[</span><span class="n">bin_index</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="n">srdata</span><span class="p">.</span><span class="n">n_sig_MC</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">weight</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">srdata</span><span class="p">.</span><span class="n">n_sig_scaled</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">weight</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>


<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">signal_cutoff_function</span><span class="p">(</span><span class="n">AnalysisData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">adata</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">lambda</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Check that we have analysis info for the given analysis</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">analysis_info_map</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">adata</span><span class="p">.</span><span class="n">analysis_name</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">ColliderBit_error</span><span class="p">().</span><span class="n">raise</span><span class="p">(</span><span class="n">LOCAL_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Unknown analysis &#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">adata</span><span class="p">.</span><span class="n">analysis_name</span><span class="w"> </span><span class="o">+</span><span class="s">&quot;&#39; encountered in signal_modifier_function!&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Get a shorthand reference to the DMEFT_analysis_info instance</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">DMEFT_analysis_info</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ainfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analysis_info_map</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">adata</span><span class="p">.</span><span class="n">analysis_name</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Modify signals with a hard cutoff</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">bin_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">bin_index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ainfo</span><span class="p">.</span><span class="n">n_signal_regions</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">bin_index</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">MET_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ainfo</span><span class="p">.</span><span class="n">extra_info</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="s">&quot;metmins&quot;</span><span class="p">)[</span><span class="n">bin_index</span><span class="p">];</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">MET_min</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">SignalRegionData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">srdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adata</span><span class="p">[</span><span class="n">bin_index</span><span class="p">];</span><span class="w"></span>
<span class="w">          </span><span class="n">srdata</span><span class="p">.</span><span class="n">n_sig_MC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="n">srdata</span><span class="p">.</span><span class="n">n_sig_scaled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>


<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">_gsl_target_func</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="cm">/* n */</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">fparams</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">fval</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Note: We don&#39;t use the first argument, it&#39;s just there for the GSL/multimin interface</span>

<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">total_loglike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Cast fparams to correct type</span>
<span class="w">      </span><span class="n">_gsl_target_func_params</span><span class="o">*</span><span class="w"> </span><span class="n">fpars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">_gsl_target_func_params</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">fparams</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="n">AnalysisLogLikes</span><span class="w"> </span><span class="n">analoglikes</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Create a vector with temp AnalysisData instances by copying the original ones</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">AnalysisData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">temp_adata_vec</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">AnalysisData</span><span class="o">*</span><span class="w"> </span><span class="n">adata_ptr</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">fpars</span><span class="o">-&gt;</span><span class="n">adata_ptrs_original</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">str</span><span class="o">&amp;</span><span class="w"> </span><span class="n">analysis_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adata_ptr</span><span class="o">-&gt;</span><span class="n">analysis_name</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// If the analysis name is in skip_analyses, don&#39;t take it into account in this profiling</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">fpars</span><span class="o">-&gt;</span><span class="n">skip_analyses</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">fpars</span><span class="o">-&gt;</span><span class="n">skip_analyses</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">analysis_name</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">fpars</span><span class="o">-&gt;</span><span class="n">skip_analyses</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Make a copy of the AnalysisData instance that adata_ptr points to</span>
<span class="w">        </span><span class="n">temp_adata_vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">AnalysisData</span><span class="p">(</span><span class="o">*</span><span class="n">adata_ptr</span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Now loop over all the temp AnalysisData instances and calculate the total loglike for the current a-value</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">AnalysisData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">adata</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">temp_adata_vec</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">signal_modifier_function</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span><span class="w"> </span><span class="n">fpars</span><span class="o">-&gt;</span><span class="n">lambda</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">analoglikes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calc_loglikes_for_analysis</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span><span class="w"> </span><span class="n">fpars</span><span class="o">-&gt;</span><span class="n">use_covar</span><span class="p">,</span><span class="w"> </span><span class="n">fpars</span><span class="o">-&gt;</span><span class="n">use_marg</span><span class="p">,</span><span class="w"> </span><span class="n">fpars</span><span class="o">-&gt;</span><span class="n">combine_nocovar_SRs</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">total_loglike</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">analoglikes</span><span class="p">.</span><span class="n">combination_loglike</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="o">*</span><span class="n">fval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">total_loglike</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>



<span class="w">    </span><span class="c1">// DMEFT: Profile the &#39;a&#39; nuisance parameter, which is used to smoothly</span>
<span class="w">    </span><span class="c1">// suppress signal predictions for MET bins with MET &gt; Lambda</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">calc_DMEFT_profiled_LHC_nuisance_params</span><span class="p">(</span><span class="n">map_str_dbl</span><span class="o">&amp;</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Pipes</span><span class="o">::</span><span class="nn">calc_DMEFT_profiled_LHC_nuisance_params</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Check if user has requested a fixed value for the a parameter</span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">use_fixed_value_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">fixed_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1e99</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">first</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">runOptions</span><span class="o">-&gt;</span><span class="n">hasKey</span><span class="p">(</span><span class="s">&quot;use_fixed_value_a&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">use_fixed_value_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="n">fixed_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runOptions</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;use_fixed_value_a&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">use_fixed_value_a</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">result</span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fixed_a</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Steal the list of skipped analyses from the options from the &quot;calc_combined_LHC_LogLike&quot; function</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">str</span><span class="o">&gt;</span><span class="w"> </span><span class="n">default_skip_analyses</span><span class="p">;</span><span class="w">  </span><span class="c1">// The default is empty lists of analyses to skip</span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">str</span><span class="o">&gt;</span><span class="w"> </span><span class="n">skip_analyses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pipes</span><span class="o">::</span><span class="n">calc_combined_LHC_LogLike</span><span class="o">::</span><span class="n">runOptions</span><span class="o">-&gt;</span><span class="n">getValueOrDef</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">str</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="n">default_skip_analyses</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;skip_analyses&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Steal some settings from the &quot;calc_LHC_LogLikes&quot; function</span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">use_covar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pipes</span><span class="o">::</span><span class="n">calc_LHC_LogLikes</span><span class="o">::</span><span class="n">runOptions</span><span class="o">-&gt;</span><span class="n">getValueOrDef</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;use_covariances&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Use marginalisation rather than profiling (probably less stable)?</span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">use_marg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pipes</span><span class="o">::</span><span class="n">calc_LHC_LogLikes</span><span class="o">::</span><span class="n">runOptions</span><span class="o">-&gt;</span><span class="n">getValueOrDef</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;use_marginalising&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Use the naive sum of SR loglikes for analyses without known correlations?</span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">combine_nocovar_SRs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pipes</span><span class="o">::</span><span class="n">calc_LHC_LogLikes</span><span class="o">::</span><span class="n">runOptions</span><span class="o">-&gt;</span><span class="n">getValueOrDef</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;combine_SRs_without_covariances&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Clear previous result map</span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Optimiser parameters</span>
<span class="w">      </span><span class="c1">// Params: step1size, tol, maxiter, epsabs, simplex maxsize, method, verbosity</span>
<span class="w">      </span><span class="c1">// Methods:</span>
<span class="w">      </span><span class="c1">//  0: Fletcher-Reeves conjugate gradient</span>
<span class="w">      </span><span class="c1">//  1: Polak-Ribiere conjugate gradient</span>
<span class="w">      </span><span class="c1">//  2: Vector Broyden-Fletcher-Goldfarb-Shanno method</span>
<span class="w">      </span><span class="c1">//  3: Steepest descent algorithm</span>
<span class="w">      </span><span class="c1">//  4: Nelder-Mead simplex</span>
<span class="w">      </span><span class="c1">//  5: Vector Broyden-Fletcher-Goldfarb-Shanno method ver. 2</span>
<span class="w">      </span><span class="c1">//  6: Simplex algorithm of Nelder and Mead ver. 2</span>
<span class="w">      </span><span class="c1">//  7: Simplex algorithm of Nelder and Mead: random initialization</span>

<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">INITIAL_STEP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runOptions</span><span class="o">-&gt;</span><span class="n">getValueOrDef</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;nuisance_prof_initstep&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">CONV_TOL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runOptions</span><span class="o">-&gt;</span><span class="n">getValueOrDef</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;nuisance_prof_convtol&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">MAXSTEPS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runOptions</span><span class="o">-&gt;</span><span class="n">getValueOrDef</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;nuisance_prof_maxsteps&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">CONV_ACC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runOptions</span><span class="o">-&gt;</span><span class="n">getValueOrDef</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;nuisance_prof_convacc&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">SIMPLEX_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runOptions</span><span class="o">-&gt;</span><span class="n">getValueOrDef</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;nuisance_prof_simplexsize&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">METHOD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runOptions</span><span class="o">-&gt;</span><span class="n">getValueOrDef</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;nuisance_prof_method&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">VERBOSITY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runOptions</span><span class="o">-&gt;</span><span class="n">getValueOrDef</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;nuisance_prof_verbosity&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">multimin</span><span class="o">::</span><span class="n">multimin_params</span><span class="w"> </span><span class="n">oparams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">INITIAL_STEP</span><span class="p">,</span><span class="w"> </span><span class="n">CONV_TOL</span><span class="p">,</span><span class="w"> </span><span class="n">MAXSTEPS</span><span class="p">,</span><span class="w"> </span><span class="n">CONV_ACC</span><span class="p">,</span><span class="w"> </span><span class="n">SIMPLEX_SIZE</span><span class="p">,</span><span class="w"> </span><span class="n">METHOD</span><span class="p">,</span><span class="w"> </span><span class="n">VERBOSITY</span><span class="p">};</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Set fixed function parameters</span>
<span class="w">      </span><span class="n">_gsl_target_func_params</span><span class="w"> </span><span class="n">fpars</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">fpars</span><span class="p">.</span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Dep</span><span class="o">::</span><span class="n">DMEFT_spectrum</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="n">Par</span><span class="o">::</span><span class="n">mass1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Lambda&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">fpars</span><span class="p">.</span><span class="n">adata_ptrs_original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">Dep</span><span class="o">::</span><span class="n">AllAnalysisNumbersUnmodified</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">fpars</span><span class="p">.</span><span class="n">skip_analyses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">skip_analyses</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">fpars</span><span class="p">.</span><span class="n">use_covar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">use_covar</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">fpars</span><span class="p">.</span><span class="n">use_marg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">use_marg</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">fpars</span><span class="p">.</span><span class="n">combine_nocovar_SRs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">combine_nocovar_SRs</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Create a variable to store the best-fit loglike</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">minus_loglike_bestfit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">50000.</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Nuisance parameter(s) to be profiled</span>
<span class="w">      </span><span class="c1">// NOTE: Currently we only profile one parameter (&#39;a&#39;), but the</span>
<span class="w">      </span><span class="c1">//       below setup can  easily be extended to more parameters</span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">init_values_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runOptions</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;init_values_a&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">range_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runOptions</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;range_a&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// How many times should we run the optimiser?</span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n_runs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_values_a</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="kt">size_t</span><span class="w"> </span><span class="n">run_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">current_bestfit_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_values_a</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">current_bestfit_loglike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">minus_loglike_bestfit</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Mute stderr while running multimin (due to verbose gsl output)?</span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">silence_multimin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runOptions</span><span class="o">-&gt;</span><span class="n">getValueOrDef</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;silence_multimin&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="c1">// Do profiling n_runs times</span>
<span class="w">      </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">run_i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_runs</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">nuisances</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">init_values_a</span><span class="p">[</span><span class="n">run_i</span><span class="p">]};</span><span class="w">  </span><span class="c1">// set initial guess for each nuisance parameter</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">nuisances_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">range_a</span><span class="p">.</span><span class="n">first</span><span class="p">};</span><span class="w">   </span><span class="c1">// min value for each nuisance parameter</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">nuisances_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">range_a</span><span class="p">.</span><span class="n">second</span><span class="p">};</span><span class="w"> </span><span class="c1">// max value for each nuisance parameter</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n_profile_pars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nuisances</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Choose boundary type for each nuisance param (see comment below)</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">boundary_types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">6</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="cm">/*</span>
<span class="cm">        From multimin.cpp:</span>
<span class="cm">          Interval:                                       Transformation:</span>
<span class="cm">          0 unconstrained                                 x=y</span>
<span class="cm">          1 semi-closed right half line [ xmin,+infty )   x=xmin+y^2</span>
<span class="cm">          2 semi-closed left  half line ( -infty,xmax ]   x=xmax-y^2</span>
<span class="cm">          3 closed interval              [ xmin,xmax ]    x=SS+SD*sin(y)</span>
<span class="cm">          4 open right half line        ( xmin,+infty )   x=xmin+exp(y)</span>
<span class="cm">          5 open left  half line        ( -infty,xmax )   x=xmax-exp(y)</span>
<span class="cm">          6 open interval                ( xmin,xmax )    x=SS+SD*tanh(y)</span>

<span class="cm">          where SS=.5(xmin+xmax) SD=.5(xmax-xmin)</span>
<span class="cm">        */</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Call the optimiser</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">silence_multimin</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">CALL_WITH_SILENCED_STDERR</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">multimin</span><span class="o">::</span><span class="n">multimin</span><span class="p">(</span><span class="n">n_profile_pars</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nuisances</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">minus_loglike_bestfit</span><span class="p">,</span><span class="w"></span>
<span class="w">                     </span><span class="o">&amp;</span><span class="n">boundary_types</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nuisances_min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nuisances_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"></span>
<span class="w">                     </span><span class="o">&amp;</span><span class="n">_gsl_target_func</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fpars</span><span class="p">,</span><span class="w"> </span><span class="n">oparams</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">multimin</span><span class="o">::</span><span class="n">multimin</span><span class="p">(</span><span class="n">n_profile_pars</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nuisances</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">minus_loglike_bestfit</span><span class="p">,</span><span class="w"></span>
<span class="w">                   </span><span class="o">&amp;</span><span class="n">boundary_types</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nuisances_min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nuisances_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"></span>
<span class="w">                   </span><span class="o">&amp;</span><span class="n">_gsl_target_func</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fpars</span><span class="p">,</span><span class="w"> </span><span class="n">oparams</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">run_i_bestfit_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nuisances</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">run_i_bestfit_loglike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">minus_loglike_bestfit</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Save info for this run</span>
<span class="w">        </span><span class="n">result</span><span class="p">[</span><span class="s">&quot;a_run&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">run_i</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">run_i_bestfit_a</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">result</span><span class="p">[</span><span class="s">&quot;loglike_run&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">run_i</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">run_i_bestfit_loglike</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Update the global result?</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">run_i_bestfit_loglike</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">current_bestfit_loglike</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">current_bestfit_loglike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">run_i_bestfit_loglike</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="n">current_bestfit_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">run_i_bestfit_a</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="n">run_i</span><span class="o">++</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="c1">// end optimisation loop</span>

<span class="w">      </span><span class="c1">// Save the overall best-fit results</span>
<span class="w">      </span><span class="n">result</span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_bestfit_a</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">result</span><span class="p">[</span><span class="s">&quot;loglike&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_bestfit_loglike</span><span class="p">;</span><span class="w"></span>


<span class="w">      </span><span class="c1">// DEBUG: Do a grid scan of a and Lambda parameter to investigate the profiled likelihood function</span>
<span class="w">      </span><span class="cp">#ifdef COLLIDERBIT_DEBUG_PROFILING</span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">log10_a_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">log10_a_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">step_log10_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.02</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">log10_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">log10_a_min</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="w"> </span><span class="n">log10_a</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">ll_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">lambda_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">670.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">lambda_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1070.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">step_lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda_min</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="n">ofstream</span><span class="w"> </span><span class="n">f</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">f</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;lambda_a_loglike.dat&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">lambda_max</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">log10_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">log10_a_min</span><span class="p">;</span><span class="w"></span>

<span class="w">          </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">log10_a</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">log10_a_max</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;DEBUG: lambda, log10_a : &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">log10_a</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="w"> </span><span class="n">log10_a</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="n">fpars</span><span class="p">.</span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="n">_gsl_target_func</span><span class="p">(</span><span class="n">n_profile_pars</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fpars</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ll_val</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">fixed</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">setprecision</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">fpars</span><span class="p">.</span><span class="n">lambda</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;  &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;  &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ll_val</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="n">log10_a</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">step_log10_a</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">          </span><span class="n">lambda</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">step_lambda</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="cp">#endif</span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>


<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">InterpolatedMCInfo</span><span class="p">(</span><span class="n">MCLoopInfo</span><span class="o">&amp;</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="n">event_gen_BYPASS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="n">reset_flags</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>


<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="c1">// namespace ColliderBit</span>

<span class="p">}</span><span class="w"> </span><span class="c1">// namespace Gambit</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  
<style>
  /* Sidebar header (and topbar for mobile) */
  .wy-side-nav-search, .wy-nav-top, .wy-nav-side {
    background: #efefef;
  }

  /* Sidebar text */
  .wy-menu-vertical a {
    color: #000000;
  }
</style>


</body>
</html>